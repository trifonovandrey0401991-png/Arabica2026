# Arabica 2026 - Полный Анализ Системы и План Тестирования

> **Дата создания:** 2026-02-01
> **Цель:** Понять все связи в приложении и создать тесты для трёх ролей

---

## 1. АРХИТЕКТУРА ПРИЛОЖЕНИЯ

### 1.1 Структура проекта

```
arabica2026/
├── lib/                          # Flutter приложение
│   ├── app/                      # Главные страницы
│   │   ├── pages/
│   │   │   ├── main_menu_page.dart      # Главное меню (точка входа)
│   │   │   ├── my_dialogs_page.dart     # Диалоги (6 типов + групповые)
│   │   │   ├── reports_page.dart        # Отчёты (только админ)
│   │   │   ├── data_management_page.dart # Управление данными (админ)
│   │   │   └── role_test_page.dart      # Тест ролей
│   │   └── services/
│   │       └── my_dialogs_counter_service.dart
│   ├── core/                     # Базовые сервисы
│   │   ├── services/
│   │   │   ├── base_http_service.dart   # Основной HTTP клиент
│   │   │   ├── firebase_service.dart    # Push уведомления
│   │   │   ├── notification_service.dart
│   │   │   └── photo_upload_service.dart
│   │   ├── constants/
│   │   │   └── api_constants.dart
│   │   └── utils/
│   │       ├── logger.dart
│   │       └── phone_normalizer.dart
│   ├── features/                 # Функциональные модули (31 модуль)
│   └── shared/                   # Общие компоненты
└── loyalty-proxy/                # Node.js сервер
    ├── index.js                  # Главный сервер (~3000 строк)
    ├── api/                      # API модули
    ├── modules/                  # Бизнес-логика
    └── utils/                    # Утилиты
```

### 1.2 Три роли пользователей

| Роль | Описание | Проверка |
|------|----------|----------|
| **Admin** | Полный доступ ко всем функциям | `isAdmin == true` в БД сотрудников |
| **Employee** | Функции для сотрудников | Найден в `/api/employees` + верифицирован |
| **Client** | Базовые функции | По умолчанию (не сотрудник) |

**Логика определения роли:**
```
1. Проверка в /api/employees по телефону
2. Если найден → проверка isAdmin
3. Если isAdmin=true → Admin
4. Если найден + верифицирован → Employee
5. Если не найден ИЛИ не верифицирован → Client
```

---

## 2. ВСЕ МОДУЛИ И ИХ СВЯЗИ

### 2.1 Карта модулей (31 модуль)

```
┌─────────────────────────────────────────────────────────────────────┐
│                        ГЛАВНОЕ МЕНЮ                                  │
│    (main_menu_page.dart)                                            │
└─────────────────────────────────────────────────────────────────────┘
                                   │
        ┌──────────────────────────┼──────────────────────────┐
        │                          │                          │
        ▼                          ▼                          ▼
┌───────────────┐        ┌───────────────┐        ┌───────────────┐
│   ДЛЯ ВСЕХ    │        │  СОТРУДНИК +  │        │   ТОЛЬКО      │
│               │        │    АДМИН      │        │   АДМИН       │
├───────────────┤        ├───────────────┤        ├───────────────┤
│ • Меню        │        │ • Панель      │        │ • Управление  │
│ • Корзина     │        │   работника   │        │   данными     │
│ • Мои заказы  │        │               │        │ • Отчёты      │
│ • Магазины    │        │               │        │               │
│   на карте    │        │               │        │               │
│ • Лояльность  │        │               │        │               │
│ • Отзывы      │        │               │        │               │
│ • Мои диалоги │        │               │        │               │
│ • Поиск       │        │               │        │               │
│   товара      │        │               │        │               │
└───────────────┘        └───────────────┘        └───────────────┘
        │                          │                          │
        │                          │                          │
        ▼                          ▼                          ▼
┌───────────────┐        ┌───────────────┐        ┌───────────────┐
│ ТОЛЬКО КЛИЕНТ │        │  ПАНЕЛЬ       │        │ УПРАВЛЕНИЕ    │
├───────────────┤        │  РАБОТНИКА    │        │ ДАННЫМИ       │
│ • Устроиться  │        ├───────────────┤        ├───────────────┤
│   на работу   │        │ • Обучение    │        │ • Магазины    │
└───────────────┘        │ • Я на работе │        │ • Сотрудники  │
                         │ • Пересменка  │        │ • График      │
                         │ • Сдать смену │        │ • Вопросы     │
                         │ • Пересчёт    │        │   (4 типа)    │
                         │ • Рецепты     │        │ • Статьи      │
                         │ • РКО         │        │ • Клиенты     │
                         │ • Заказы      │        │ • Поставщики  │
                         │ • Чат         │        │ • Баллы       │
                         │ • Бонусы      │        │ • Задачи      │
                         │ • Код         │        │ • Премии      │
                         │ • Мой график  │        │ • ИИ          │
                         │ • Вопросы о   │        │ • Очистка     │
                         │   товарах     │        │               │
                         │ • Эффективн.  │        │               │
                         │ • Мои задачи  │        │               │
                         │ • Колесо      │        │               │
                         └───────────────┘        └───────────────┘
```

### 2.2 Подробные связи между модулями

```
┌───────────────────────────────────────────────────────────────────────────┐
│                          SHOPS (Магазины)                                  │
│                    /var/www/shops/shop_*.json                              │
└───────────────────────────────────────────────────────────────────────────┘
         │
         ├──► Attendance (посещаемость) - shopAddress, координаты
         ├──► Shifts (пересменки) - shopAddress
         ├──► Recount (пересчёты) - shopAddress
         ├──► Envelope (конверты) - shopAddress
         ├──► RKO (кассовые ордера) - shopAddress, ИНН, директор
         ├──► Reviews (отзывы) - shopAddress
         ├──► Work Schedule (график) - shopAddress
         ├──► KPI (аналитика) - shopAddress для фильтрации
         └──► Geofence (геозоны) - координаты

┌───────────────────────────────────────────────────────────────────────────┐
│                        EMPLOYEES (Сотрудники)                              │
│                    /var/www/employees/*.json                               │
└───────────────────────────────────────────────────────────────────────────┘
         │
         ├──► Attendance - employeeId, employeeName
         ├──► Shifts - employeeName
         ├──► Recount - employeeName
         ├──► ShiftHandover (сдача смены) - employeeName
         ├──► RKO - employeeName
         ├──► Efficiency (эффективность) - employeeId
         ├──► Tasks (задачи) - assignedTo
         ├──► Rating (рейтинг) - employeeId
         ├──► Fortune Wheel (колесо) - employeeId
         ├──► Referrals (приглашения) - referralCode
         └──► Employee Chat - participantId

┌───────────────────────────────────────────────────────────────────────────┐
│                      EFFICIENCY (Эффективность)                            │
│           efficiency_calc.js - 12 категорий баллов                         │
└───────────────────────────────────────────────────────────────────────────┘
         │
         ├──► Shift Reports - adminRating → баллы
         ├──► Recount Reports - adminRating → баллы
         ├──► ShiftHandover Reports - rating → баллы
         ├──► Attendance - isOnTime → баллы
         ├──► Tests - score → баллы
         ├──► Reviews - rating → баллы
         ├──► Product Questions - answered → баллы
         ├──► RKO - hasRko → баллы
         ├──► Tasks - completed → баллы
         ├──► Orders - accepted → баллы
         ├──► Envelope - status → баллы
         └──► Penalties - штрафы
                    ▲
                    │
         ┌─────────┴─────────┐
         │    АВТОШТРАФЫ     │
         ├───────────────────┤
         │ shift_missed      │
         │ envelope_missed   │
         │ rko_missed        │
         │ attendance_missed │
         └───────────────────┘
```

### 2.3 Автоматизация (Schedulers)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     AUTOMATION SCHEDULERS                                │
│              (Проверка каждые 5 минут)                                  │
└─────────────────────────────────────────────────────────────────────────┘

1. shift_automation_scheduler.js
   ├── Создание pending отчётов при начале смены
   ├── pending → failed при пропуске дедлайна
   ├── review → rejected по таймауту админа
   ├── Начисление штрафов (-5 баллов)
   └── Очистка в 23:59

2. recount_automation_scheduler.js
   ├── Создание pending пересчётов
   ├── Переход статусов
   └── Штрафы за пропуск

3. envelope_automation_scheduler.js
   ├── Утренние окна (07:00-09:00)
   ├── Вечерние окна (19:00-21:00)
   ├── pending → failed после дедлайна
   └── Штрафы (-5 баллов)

4. attendance_automation_scheduler.js
   ├── Проверка отметок "Я на работе"
   ├── Геолокация проверка
   └── Штрафы за неявку

5. rko_automation_scheduler.js
   ├── Проверка РКО за день
   └── Штрафы за отсутствие
```

---

## 3. ФУНКЦИОНАЛ ПО РОЛЯМ

### 3.1 Функционал КЛИЕНТА

| Функция | Описание | API Endpoints |
|---------|----------|---------------|
| **Меню** | Просмотр меню по магазинам | GET /api/menu/{shop} |
| **Корзина** | Добавление товаров | Local storage |
| **Мои заказы** | История заказов | GET /api/orders?phone={phone} |
| **Магазины на карте** | Карта с кофейнями | GET /api/shops |
| **Карта лояльности** | QR-код, баллы, бонусы | GET /?action=getClient |
| **Отзывы** | Оставить отзыв | POST /api/reviews |
| **Мои диалоги** | 6 типов диалогов | Multiple endpoints |
| **Поиск товара** | Задать вопрос о наличии | POST /api/product-questions |
| **Устроиться на работу** | Заявка на работу | POST /api/job-applications |

**Диалоги клиента:**
1. Сетевые сообщения (от сети)
2. Сообщения руководству
3. Мои отзывы (ответы на отзывы)
4. Поиск товара (общий чат)
5. Персональные диалоги (с сотрудниками)
6. Групповые чаты

### 3.2 Функционал СОТРУДНИКА

| Функция | Описание | API Endpoints |
|---------|----------|---------------|
| **Обучение** | Статьи обучения | GET /api/training-articles |
| **Тестирование** | Прохождение тестов | POST /api/tests |
| **Я на работе** | Отметка присутствия | POST /api/attendance |
| **Пересменка** | Сдача отчёта пересменки | POST /api/shift-reports |
| **Сдать смену** | Сдача смены с вопросами | POST /api/shift-handovers |
| **Пересчёт** | Пересчёт товаров | POST /api/recount-reports |
| **Рецепты** | Просмотр рецептов | GET /api/recipes |
| **РКО** | Кассовые документы | POST /api/rko |
| **Заказы (сотр.)** | Обработка заказов | GET/PUT /api/orders |
| **Чат сотрудников** | Внутренний чат | /api/employee-chats |
| **Бонусы** | Списание бонусов | POST /?action=redeem |
| **Мой график** | Личное расписание | GET /api/work-schedule/{employee} |
| **Вопросы о товарах** | Ответы на вопросы | PUT /api/product-questions/{id} |
| **Моя эффективность** | Статистика баллов | GET /api/efficiency/{employee} |
| **Мои задачи** | Выполнение задач | GET /api/tasks/my/{employee} |
| **Колесо удачи** | Прокрутки за рейтинг | POST /api/fortune-wheel/spin |

### 3.3 Функционал АДМИНИСТРАТОРА

| Функция | Описание | API Endpoints |
|---------|----------|---------------|
| **Магазины** | CRUD магазинов | /api/shops |
| **Сотрудники** | CRUD сотрудников | /api/employees |
| **График работы** | Составление графика | /api/work-schedule |
| **Вопросы пересменки** | Настройка вопросов | /api/shift-questions |
| **Вопросы пересчёта** | Настройка вопросов | /api/recount-questions |
| **Вопросы тестирования** | Настройка тестов | /api/test-questions |
| **Вопросы сдачи смены** | Настройка вопросов | /api/shift-handover-questions |
| **Статьи обучения** | CRUD статей | /api/training-articles |
| **Клиенты** | Управление клиентами | /api/clients |
| **Поставщики** | Управление поставщиками | /api/suppliers |
| **Установка баллов** | Настройка баллов | /api/points-settings |
| **Задачи** | Создание задач | /api/tasks |
| **Премии/Штрафы** | Ручные баллы | /api/bonus-penalties |
| **Обучение ИИ** | AI training | /api/ai-training |
| **Очистка историй** | Удаление данных | /api/data-cleanup |

**Отчёты администратора:**
- РКО
- Пересменки
- Сдача смены
- Конверты
- Пересчёты
- Посещаемость
- KPI
- Отзывы
- Поиск товара
- Тестирование
- Эффективность
- Задачи
- Главная касса
- Заявки на работу
- Приглашения (рефералы)
- Колесо удачи
- Заказы
- Заявки на смены

---

## 4. КРИТИЧЕСКИЕ СВЯЗИ (Узкие места)

### 4.1 Зависимости данных

```
EFFICIENCY CALCULATION
│
├── Зависит от 12 источников данных:
│   ├── /var/www/shift-reports/ (пересменки)
│   ├── /var/www/recount-reports/ (пересчёты)
│   ├── /var/www/shift-handovers/ (сдача смены)
│   ├── /var/www/attendance/ (посещаемость)
│   ├── /var/www/test-results/ (тесты)
│   ├── /var/www/client-reviews/ (отзывы)
│   ├── /var/www/product-questions/ (вопросы)
│   ├── /var/www/rko/ (кассовые документы)
│   ├── /var/www/tasks/ (разовые задачи)
│   ├── /var/www/recurring-tasks/ (циклические)
│   ├── /var/www/envelope-reports/ (конверты)
│   └── /var/www/efficiency-penalties/ (штрафы)
│
└── Влияет на:
    ├── Rating (рейтинг сотрудников)
    ├── Fortune Wheel (прокрутки топ-3)
    └── KPI (показатели)
```

### 4.2 Узкие места для тестирования

1. **Нормализация телефонов** - везде используется `phone.replace(/[\s\+]/g, '')`
2. **Временные окна** - все scheduler'ы работают по московскому времени (UTC+3)
3. **Статусы отчётов** - pending → review → confirmed/rejected/failed
4. **Верификация сотрудников** - без неё функционал ограничен
5. **Кэширование** - 10 минут для списка магазинов
6. **Batch операции** - efficiency_calc.js использует кэш для производительности

---

## 5. ПЕРЕЧЕНЬ ТЕСТОВ ДЛЯ РЕАЛИЗАЦИИ

### 5.1 ТЕСТЫ ДЛЯ РОЛИ КЛИЕНТА (Client Tests)

#### 5.1.1 Регистрация и авторизация
```dart
// test/client/auth_test.dart
group('Client Authentication', () {
  test('CT-AUTH-001: Регистрация нового клиента', () {
    // 1. Ввести телефон
    // 2. Подтвердить SMS
    // 3. Ввести имя
    // 4. Проверить сохранение в SharedPreferences
    // 5. Проверить роль = client
  });

  test('CT-AUTH-002: Повторный вход по телефону', () {});
  test('CT-AUTH-003: Выход из аккаунта', () {});
});
```

#### 5.1.2 Меню и заказы
```dart
// test/client/menu_orders_test.dart
group('Client Menu & Orders', () {
  test('CT-MENU-001: Просмотр категорий меню', () {});
  test('CT-MENU-002: Просмотр товаров в категории', () {});
  test('CT-MENU-003: Добавление в корзину', () {});
  test('CT-CART-001: Изменение количества в корзине', () {});
  test('CT-CART-002: Удаление из корзины', () {});
  test('CT-ORDER-001: Оформление заказа', () {});
  test('CT-ORDER-002: Просмотр истории заказов', () {});
  test('CT-ORDER-003: Отмена заказа', () {});
});
```

#### 5.1.3 Карта лояльности
```dart
// test/client/loyalty_test.dart
group('Client Loyalty', () {
  test('CT-LOY-001: Отображение QR-кода', () {});
  test('CT-LOY-002: Отображение баланса баллов', () {});
  test('CT-LOY-003: Прогресс до бесплатного напитка', () {});
  test('CT-LOY-004: История начислений', () {});
});
```

#### 5.1.4 Отзывы
```dart
// test/client/reviews_test.dart
group('Client Reviews', () {
  test('CT-REV-001: Создание отзыва с рейтингом', () {});
  test('CT-REV-002: Добавление фото к отзыву', () {});
  test('CT-REV-003: Просмотр ответа на отзыв', () {});
  test('CT-REV-004: Отправка дополнительного сообщения', () {});
});
```

#### 5.1.5 Диалоги
```dart
// test/client/dialogs_test.dart
group('Client Dialogs', () {
  test('CT-DLG-001: Просмотр сетевых сообщений', () {});
  test('CT-DLG-002: Отправка сообщения руководству', () {});
  test('CT-DLG-003: Просмотр персональных диалогов', () {});
  test('CT-DLG-004: Участие в групповом чате', () {});
  test('CT-DLG-005: Счётчик непрочитанных', () {});
});
```

#### 5.1.6 Поиск товара
```dart
// test/client/product_search_test.dart
group('Client Product Search', () {
  test('CT-PS-001: Выбор магазина для вопроса', () {});
  test('CT-PS-002: Отправка вопроса о товаре', () {});
  test('CT-PS-003: Получение ответа от сотрудника', () {});
  test('CT-PS-004: Добавление фото к вопросу', () {});
});
```

#### 5.1.7 Магазины на карте
```dart
// test/client/shops_map_test.dart
group('Client Shops Map', () {
  test('CT-MAP-001: Отображение всех магазинов', () {});
  test('CT-MAP-002: Определение ближайшего магазина', () {});
  test('CT-MAP-003: Открытие маршрута', () {});
});
```

#### 5.1.8 Устроиться на работу
```dart
// test/client/job_application_test.dart
group('Client Job Application', () {
  test('CT-JOB-001: Заполнение анкеты', () {});
  test('CT-JOB-002: Загрузка фото', () {});
  test('CT-JOB-003: Отправка заявки', () {});
});
```

---

### 5.2 ТЕСТЫ ДЛЯ РОЛИ СОТРУДНИКА (Employee Tests)

#### 5.2.1 Авторизация сотрудника
```dart
// test/employee/auth_test.dart
group('Employee Authentication', () {
  test('ET-AUTH-001: Определение роли сотрудника', () {
    // 1. Телефон есть в /api/employees
    // 2. isAdmin = false
    // 3. Сотрудник верифицирован
    // → Роль = employee
  });

  test('ET-AUTH-002: Невериф. сотрудник → client', () {});
  test('ET-AUTH-003: Загрузка employeeId', () {});
});
```

#### 5.2.2 Обучение и тестирование
```dart
// test/employee/training_test.dart
group('Employee Training', () {
  test('ET-TRN-001: Просмотр списка статей', () {});
  test('ET-TRN-002: Чтение статьи', () {});
  test('ET-TEST-001: Прохождение теста', () {});
  test('ET-TEST-002: Просмотр результата', () {});
  test('ET-TEST-003: Начисление баллов за тест', () {});
});
```

#### 5.2.3 Посещаемость
```dart
// test/employee/attendance_test.dart
group('Employee Attendance', () {
  test('ET-ATT-001: Отметка "Я на работе"', () {
    // 1. Проверка геолокации
    // 2. Определение магазина
    // 3. Проверка времени смены
    // 4. Создание записи attendance
    // 5. Начисление баллов
  });

  test('ET-ATT-002: Повторная отметка за день', () {
    // Должна блокироваться
  });

  test('ET-ATT-003: Опоздание на смену', () {
    // Меньше баллов (latePoints)
  });

  test('ET-ATT-004: Вне радиуса магазина', () {
    // Ошибка геолокации
  });
});
```

#### 5.2.4 Пересменка
```dart
// test/employee/shift_test.dart
group('Employee Shift Reports', () {
  test('ET-SH-001: Выбор магазина для пересменки', () {});
  test('ET-SH-002: Ответы на вопросы пересменки', () {});
  test('ET-SH-003: Загрузка фото недостачи', () {});
  test('ET-SH-004: Отправка отчёта', () {
    // Статус = review
  });
  test('ET-SH-005: Просрочка дедлайна', () {
    // TIME_EXPIRED ошибка
  });
});
```

#### 5.2.5 Сдача смены
```dart
// test/employee/shift_handover_test.dart
group('Employee Shift Handover', () {
  test('ET-SHH-001: Выбор магазина', () {});
  test('ET-SHH-002: Ответы на вопросы с фото', () {});
  test('ET-SHH-003: Отправка отчёта сдачи смены', () {});
});
```

#### 5.2.6 Пересчёт
```dart
// test/employee/recount_test.dart
group('Employee Recount', () {
  test('ET-RC-001: Выбор магазина и смены', () {});
  test('ET-RC-002: Ответы на вопросы пересчёта', () {});
  test('ET-RC-003: Отправка отчёта пересчёта', () {});
  test('ET-RC-004: Просрочка дедлайна пересчёта', () {});
});
```

#### 5.2.7 РКО
```dart
// test/employee/rko_test.dart
group('Employee RKO', () {
  test('ET-RKO-001: Выбор типа РКО', () {});
  test('ET-RKO-002: Заполнение данных РКО', () {});
  test('ET-RKO-003: Генерация PDF', () {});
  test('ET-RKO-004: Верификация для РКО', () {
    // Только верифицированные
  });
});
```

#### 5.2.8 Заказы сотрудника
```dart
// test/employee/employee_orders_test.dart
group('Employee Orders', () {
  test('ET-ORD-001: Просмотр входящих заказов', () {});
  test('ET-ORD-002: Принятие заказа', () {});
  test('ET-ORD-003: Отклонение заказа', () {});
  test('ET-ORD-004: Отметка "Готов"', () {});
  test('ET-ORD-005: Отметка "Выдан"', () {});
});
```

#### 5.2.9 Чат сотрудников
```dart
// test/employee/chat_test.dart
group('Employee Chat', () {
  test('ET-CHAT-001: Общий чат компании', () {});
  test('ET-CHAT-002: Чат магазина', () {});
  test('ET-CHAT-003: Приватные сообщения', () {});
  test('ET-CHAT-004: Создание группового чата', () {});
  test('ET-CHAT-005: Отправка фото в чате', () {});
  test('ET-CHAT-006: WebSocket уведомления', () {});
});
```

#### 5.2.10 Бонусы
```dart
// test/employee/bonuses_test.dart
group('Employee Bonuses', () {
  test('ET-BON-001: Сканирование QR клиента', () {});
  test('ET-BON-002: Начисление балла', () {});
  test('ET-BON-003: Выдача бонуса (redeem)', () {});
});
```

#### 5.2.11 Мой график
```dart
// test/employee/schedule_test.dart
group('Employee Schedule', () {
  test('ET-SCH-001: Просмотр личного графика', () {});
  test('ET-SCH-002: Запрос на смену', () {});
  test('ET-SCH-003: Обмен сменами', () {});
});
```

#### 5.2.12 Вопросы о товарах
```dart
// test/employee/product_questions_test.dart
group('Employee Product Questions', () {
  test('ET-PQ-001: Просмотр неотвеченных вопросов', () {});
  test('ET-PQ-002: Ответ на вопрос', () {});
  test('ET-PQ-003: Персональный диалог с клиентом', () {});
});
```

#### 5.2.13 Эффективность
```dart
// test/employee/efficiency_test.dart
group('Employee Efficiency', () {
  test('ET-EFF-001: Просмотр общих баллов', () {});
  test('ET-EFF-002: Детализация по категориям', () {});
  test('ET-EFF-003: История штрафов', () {});
});
```

#### 5.2.14 Задачи
```dart
// test/employee/tasks_test.dart
group('Employee Tasks', () {
  test('ET-TSK-001: Просмотр активных задач', () {});
  test('ET-TSK-002: Выполнение задачи', () {});
  test('ET-TSK-003: Загрузка фото результата', () {});
  test('ET-TSK-004: Циклические задачи', () {});
});
```

#### 5.2.15 Колесо удачи
```dart
// test/employee/fortune_wheel_test.dart
group('Employee Fortune Wheel', () {
  test('ET-FW-001: Проверка доступных прокруток', () {});
  test('ET-FW-002: Прокрутка колеса', () {});
  test('ET-FW-003: Получение приза', () {});
});
```

---

### 5.3 ТЕСТЫ ДЛЯ РОЛИ АДМИНИСТРАТОРА (Admin Tests)

#### 5.3.1 Авторизация администратора
```dart
// test/admin/auth_test.dart
group('Admin Authentication', () {
  test('AT-AUTH-001: Определение роли админа', () {
    // isAdmin = true → role = admin
  });
});
```

#### 5.3.2 Управление магазинами
```dart
// test/admin/shops_test.dart
group('Admin Shops Management', () {
  test('AT-SHOP-001: Создание магазина', () {});
  test('AT-SHOP-002: Редактирование магазина', () {});
  test('AT-SHOP-003: Установка координат', () {});
  test('AT-SHOP-004: Настройки смен', () {});
  test('AT-SHOP-005: Удаление магазина', () {});
});
```

#### 5.3.3 Управление сотрудниками
```dart
// test/admin/employees_test.dart
group('Admin Employees Management', () {
  test('AT-EMP-001: Создание сотрудника', () {});
  test('AT-EMP-002: Верификация сотрудника', () {});
  test('AT-EMP-003: Назначение админом', () {});
  test('AT-EMP-004: Редактирование данных', () {});
  test('AT-EMP-005: Архивирование сотрудника', () {});
  test('AT-EMP-006: Предпочтения сотрудника', () {});
});
```

#### 5.3.4 График работы
```dart
// test/admin/work_schedule_test.dart
group('Admin Work Schedule', () {
  test('AT-WS-001: Создание графика', () {});
  test('AT-WS-002: Автозаполнение графика', () {});
  test('AT-WS-003: Массовое редактирование', () {});
  test('AT-WS-004: Валидация графика', () {});
  test('AT-WS-005: Генерация PDF', () {});
  test('AT-WS-006: Обработка заявок на смены', () {});
});
```

#### 5.3.5 Вопросы (все типы)
```dart
// test/admin/questions_test.dart
group('Admin Questions Management', () {
  test('AT-Q-001: Вопросы пересменки CRUD', () {});
  test('AT-Q-002: Вопросы пересчёта CRUD', () {});
  test('AT-Q-003: Вопросы тестирования CRUD', () {});
  test('AT-Q-004: Вопросы сдачи смены CRUD', () {});
  test('AT-Q-005: Загрузка эталонных фото', () {});
});
```

#### 5.3.6 Статьи обучения
```dart
// test/admin/training_articles_test.dart
group('Admin Training Articles', () {
  test('AT-TRN-001: Создание статьи', () {});
  test('AT-TRN-002: Редактор контента', () {});
  test('AT-TRN-003: Загрузка изображений', () {});
  test('AT-TRN-004: Публикация/снятие', () {});
});
```

#### 5.3.7 Клиенты
```dart
// test/admin/clients_test.dart
group('Admin Clients Management', () {
  test('AT-CLI-001: Просмотр списка клиентов', () {});
  test('AT-CLI-002: Поиск клиента', () {});
  test('AT-CLI-003: Детали клиента', () {});
  test('AT-CLI-004: Отправка сетевого сообщения', () {});
});
```

#### 5.3.8 Установка баллов
```dart
// test/admin/points_settings_test.dart
group('Admin Points Settings', () {
  test('AT-PTS-001: Настройки пересменки', () {});
  test('AT-PTS-002: Настройки пересчёта', () {});
  test('AT-PTS-003: Настройки сдачи смены', () {});
  test('AT-PTS-004: Настройки посещаемости', () {});
  test('AT-PTS-005: Настройки тестирования', () {});
  test('AT-PTS-006: Настройки рефералов', () {});
  test('AT-PTS-007: Настройки конвертов', () {});
  test('AT-PTS-008: Настройки задач', () {});
});
```

#### 5.3.9 Задачи
```dart
// test/admin/tasks_test.dart
group('Admin Tasks Management', () {
  test('AT-TSK-001: Создание разовой задачи', () {});
  test('AT-TSK-002: Создание циклической задачи', () {});
  test('AT-TSK-003: Назначение исполнителей', () {});
  test('AT-TSK-004: Проверка выполнения', () {});
  test('AT-TSK-005: Просрочка задачи', () {});
});
```

#### 5.3.10 Премии и штрафы
```dart
// test/admin/bonus_penalty_test.dart
group('Admin Bonus Penalty', () {
  test('AT-BP-001: Создание премии', () {});
  test('AT-BP-002: Создание штрафа', () {});
  test('AT-BP-003: История премий/штрафов', () {});
});
```

#### 5.3.11 Отчёты (все типы)
```dart
// test/admin/reports_test.dart
group('Admin Reports', () {
  test('AT-REP-001: Отчёты РКО', () {});
  test('AT-REP-002: Отчёты пересменок', () {});
  test('AT-REP-003: Отчёты сдачи смены', () {});
  test('AT-REP-004: Отчёты конвертов', () {});
  test('AT-REP-005: Отчёты пересчётов', () {});
  test('AT-REP-006: Отчёты посещаемости', () {});
  test('AT-REP-007: KPI отчёты', () {});
  test('AT-REP-008: Отчёты отзывов', () {});
  test('AT-REP-009: Отчёты поиска товара', () {});
  test('AT-REP-010: Отчёты тестирования', () {});
  test('AT-REP-011: Эффективность сотрудников', () {});
  test('AT-REP-012: Отчёты задач', () {});
  test('AT-REP-013: Главная касса', () {});
  test('AT-REP-014: Заявки на работу', () {});
  test('AT-REP-015: Рефералы', () {});
  test('AT-REP-016: Колесо удачи', () {});
  test('AT-REP-017: Заказы', () {});
  test('AT-REP-018: Заявки на смены', () {});
});
```

#### 5.3.12 Оценка отчётов
```dart
// test/admin/report_rating_test.dart
group('Admin Report Rating', () {
  test('AT-RAT-001: Оценка пересменки', () {
    // adminRating 1-10 → баллы
  });
  test('AT-RAT-002: Оценка пересчёта', () {});
  test('AT-RAT-003: Оценка сдачи смены', () {});
  test('AT-RAT-004: Подтверждение конверта', () {});
  test('AT-RAT-005: Отклонение отчёта', () {});
});
```

#### 5.3.13 Рейтинг и колесо
```dart
// test/admin/rating_wheel_test.dart
group('Admin Rating & Wheel', () {
  test('AT-RW-001: Расчёт рейтинга за месяц', () {});
  test('AT-RW-002: Настройка секторов колеса', () {});
  test('AT-RW-003: История прокруток', () {});
  test('AT-RW-004: Отметка приза выданным', () {});
});
```

#### 5.3.14 Очистка данных
```dart
// test/admin/data_cleanup_test.dart
group('Admin Data Cleanup', () {
  test('AT-CLN-001: Очистка старых отчётов', () {});
  test('AT-CLN-002: Очистка по категориям', () {});
});
```

---

### 5.4 ИНТЕГРАЦИОННЫЕ ТЕСТЫ

#### 5.4.1 Полный цикл пересменки
```dart
// test/integration/shift_cycle_test.dart
test('INT-001: Полный цикл пересменки', () {
  // 1. Админ создаёт вопросы
  // 2. Сотрудник отвечает на вопросы
  // 3. Сотрудник отправляет отчёт
  // 4. Админ оценивает отчёт
  // 5. Баллы начисляются сотруднику
  // 6. Эффективность обновляется
});
```

#### 5.4.2 Автоматизация штрафов
```dart
// test/integration/penalties_test.dart
test('INT-002: Автоштраф за пропуск', () {
  // 1. Создаётся pending отчёт
  // 2. Дедлайн истекает
  // 3. pending → failed
  // 4. Штраф в efficiency-penalties
  // 5. Эффективность уменьшается
});
```

#### 5.4.3 Расчёт рейтинга
```dart
// test/integration/rating_test.dart
test('INT-003: Расчёт рейтинга топ-3', () {
  // 1. 10 сотрудников работают месяц
  // 2. Начисляются баллы по 12 категориям
  // 3. Расчёт рейтинга (эфф. / смены + рефералы)
  // 4. Топ-3 получают прокрутки
  // 5. Сотрудник крутит колесо
});
```

#### 5.4.4 Полный цикл заказа
```dart
// test/integration/order_cycle_test.dart
test('INT-004: Полный цикл заказа', () {
  // 1. Клиент оформляет заказ
  // 2. Сотрудник видит заказ
  // 3. Сотрудник принимает
  // 4. Сотрудник отмечает "Готов"
  // 5. Сотрудник отмечает "Выдан"
  // 6. Клиент видит статус
});
```

---

### 5.5 ТЕСТЫ СЕРВЕРНОЙ ЧАСТИ (API Tests)

```javascript
// test/api/employees_api.test.js
describe('Employees API', () => {
  test('GET /api/employees', async () => {});
  test('POST /api/employees', async () => {});
  test('PUT /api/employees/:id', async () => {});
  test('DELETE /api/employees/:id', async () => {});
});

// test/api/shifts_api.test.js
describe('Shifts API', () => {
  test('GET /api/shift-reports', async () => {});
  test('POST /api/shift-reports', async () => {});
  test('POST /api/shift-reports/:id/rating', async () => {});
});

// test/api/efficiency_api.test.js
describe('Efficiency API', () => {
  test('GET /api/efficiency/:employeeId', async () => {});
  test('Correct points calculation', async () => {});
});

// test/api/rating_api.test.js
describe('Rating API', () => {
  test('GET /api/ratings', async () => {});
  test('POST /api/ratings/calculate', async () => {});
});
```

---

## 6. ПРИОРИТЕТЫ ТЕСТИРОВАНИЯ

### 6.1 Критический уровень (P0)
1. Авторизация и определение роли
2. Расчёт эффективности (12 категорий)
3. Автоматизация штрафов
4. Пересменка (полный цикл)
5. Посещаемость с геолокацией

### 6.2 Высокий приоритет (P1)
1. Заказы (клиент + сотрудник)
2. Рейтинг и колесо удачи
3. Конверты (автоматизация)
4. Чат сотрудников
5. Задачи (разовые + циклические)

### 6.3 Средний приоритет (P2)
1. Меню и корзина
2. Карта лояльности
3. Отзывы
4. Поиск товара
5. Обучение и тестирование

### 6.4 Низкий приоритет (P3)
1. Рецепты
2. Поставщики
3. Очистка данных
4. Магазины на карте

---

## 7. МЕТРИКИ КАЧЕСТВА

### 7.1 Целевое покрытие
- **Unit tests**: 80%
- **Integration tests**: 60%
- **E2E tests**: 40%

### 7.2 Критерии успеха
- Все P0 тесты проходят
- Нет регрессий в защищённых модулях
- Время выполнения тестов < 10 минут

---

## 8. СЛЕДУЮЩИЕ ШАГИ

1. [ ] Создать структуру папок для тестов
2. [ ] Настроить test runner (flutter_test + jest)
3. [ ] Реализовать P0 тесты
4. [ ] Настроить CI/CD для автотестов
5. [ ] Реализовать P1 тесты
6. [ ] Документировать найденные баги

---

> **Автор:** Claude Code Analysis
> **Версия:** 1.0
