# üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Arabica2026

**–ü—Ä–æ–µ–∫—Ç:** Arabica2026 Coffee Shop Management System
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-29
**–í–µ—Ä—Å–∏—è:** 2.0 (–ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø—Ä–∞–≤–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

---

## üéØ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

### –û–ø–∏—Å–∞–Ω–∏–µ
Arabica2026 - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç—å—é –∫–æ—Ñ–µ–µ–Ω, –≤–∫–ª—é—á–∞—é—â–∞—è:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ —Ä–∞–±–æ—Ç—ã
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –∏ –∑–∞–∫–∞–∑–∞–º–∏
- KPI –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –∏ –æ—Ç–º–µ—Ç–∫–∏
- –†–ö–û (—Ä–∞—Å—Ö–æ–¥–Ω—ã–µ –∫–∞—Å—Å–æ–≤—ã–µ –æ—Ä–¥–µ—Ä–∞)
- –û—Ç–∑—ã–≤—ã –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **–ö–ª–∏–µ–Ω—Ç:** Flutter (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ Web + Android + iOS)
- **–°–µ—Ä–≤–µ—Ä:** Node.js Express
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (JSON —Ñ–∞–π–ª—ã)
- **–•–æ—Å—Ç–∏–Ω–≥:** arabica26.ru
- **–í–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** refactoring/full-restructure

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–æ–ª–∏
```dart
enum UserRole {
  admin,     // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
  employee,  // –°–æ—Ç—Ä—É–¥–Ω–∏–∫ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
  client,    // –ö–ª–∏–µ–Ω—Ç - –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
}
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:**
- –¢–µ–ª–µ—Ñ–æ–Ω: 79054443224

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

### Flutter Client
```
lib/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_constants.dart       # URL, endpoints, timeouts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_constants.dart       # –†–∞–¥–∏—É—Å –æ—Ç–º–µ—Ç–æ–∫, –≥—Ä–∞–Ω–∏—Ü—ã —Å–º–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base_http_service.dart   # –ë–∞–∑–æ–≤—ã–π HTTP —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ logger.dart              # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ cache_manager.dart       # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îî‚îÄ‚îÄ phone_normalizer.dart    # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ features/                         # Feature-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ attendance/                   # –û—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ clients/                      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ employees/                    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ kpi/                          # KPI –∏ –º–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ menu/                         # –ú–µ–Ω—é –∏ –ø—Ä–æ–¥—É–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ orders/                       # –ó–∞–∫–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ recipes/                      # –†–µ—Ü–µ–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ reviews/                      # –û—Ç–∑—ã–≤—ã
‚îÇ   ‚îú‚îÄ‚îÄ rko/                          # –†–ö–û
‚îÇ   ‚îú‚îÄ‚îÄ shops/                        # –ú–∞–≥–∞–∑–∏–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ work_schedule/                # –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ shared/                           # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ widgets/                      # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–∏–¥–∂–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ dialogs/                      # –î–∏–∞–ª–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ providers/                    # State management
‚îÇ
‚îî‚îÄ‚îÄ main.dart                         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

### Node.js Server
```
/root/loyalty-proxy/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ constants.js              # –ü—É—Ç–∏, URL, –ª–∏–º–∏—Ç—ã
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js           # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ validation.js             # –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ fileSystem.js             # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ dataFilter.js             # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ routes/                       # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ attendance.js
‚îÇ   ‚îú‚îÄ‚îÄ clients.js
‚îÇ   ‚îú‚îÄ‚îÄ employees.js
‚îÇ   ‚îú‚îÄ‚îÄ menu.js
‚îÇ   ‚îú‚îÄ‚îÄ orders.js
‚îÇ   ‚îú‚îÄ‚îÄ recount.js
‚îÇ   ‚îú‚îÄ‚îÄ rko.js
‚îÇ   ‚îú‚îÄ‚îÄ shops.js
‚îÇ   ‚îî‚îÄ‚îÄ workSchedule.js
‚îî‚îÄ‚îÄ index.js                      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (~100 —Å—Ç—Ä–æ–∫)
```

---

## üîê –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª–µ–π

### UserRoleService

**–§–∞–π–ª:** `lib/features/user_role/services/user_role_service.dart`

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏:**
```dart
static Future<UserRole> determineUserRole(String phone) async {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  if (phone == '79054443224') {
    return UserRole.admin;
  }

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  final employees = await EmployeeService.getEmployees();
  final isEmployee = employees.any((emp) =>
    PhoneNormalizer.normalize(emp.phone) == PhoneNormalizer.normalize(phone)
  );

  if (isEmployee) {
    return UserRole.employee;
  }

  // 3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –∫–ª–∏–µ–Ω—Ç
  return UserRole.client;
}
```

**–î–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –ø–æ —Ä–æ–ª—è–º:**

| –§—É–Ω–∫—Ü–∏—è | Admin | Employee | Client |
|---------|-------|----------|--------|
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ | ‚úÖ | ‚ùå | ‚ùå |
| –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã | ‚úÖ | ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä | ‚ùå |
| –û—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ | ‚úÖ | ‚úÖ | ‚ùå |
| –†–ö–û | ‚úÖ | ‚úÖ | ‚ùå |
| **–û—Ç—á–µ—Ç—ã (Reports)** | ‚úÖ | ‚ùå | ‚ùå |
| KPI | ‚úÖ | ‚úÖ –°–≤–æ–∏ | ‚ùå |
| –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ | ‚úÖ | ‚ùå | ‚úÖ |
| –ó–∞–∫–∞–∑—ã | ‚úÖ | ‚úÖ | ‚ùå |

**–í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (Commit e2c9901):**
```dart
// –í main_menu_page.dart —Å—Ç—Ä–æ–∫–∞ 365
// –ë–´–õ–û: if (role == UserRole.admin || role == UserRole.employee)
// –°–¢–ê–õ–û: if (role == UserRole.admin)
// –¢–µ–ø–µ—Ä—å Reports –≤–∏–¥—è—Ç –¢–û–õ–¨–ö–û –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
```

---

## üìä –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–º (Work Schedule)

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**WorkScheduleEntry:**
```dart
class WorkScheduleEntry {
  String id;
  String employeeId;
  String employeeName;
  String shopAddress;
  DateTime date;
  ShiftType shiftType;  // morning, day, evening
}
```

**Employee (–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è):**
```dart
class Employee {
  String id;
  String name;
  String phone;

  // –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
  List<String> preferredShops;        // –°–ø–∏—Å–æ–∫ ID –º–∞–≥–∞–∑–∏–Ω–æ–≤
  List<String> preferredWorkDays;     // ['monday', 'friday', ...]
  Map<String, int> shiftPreferences;  // {'morning': 1, 'evening': 2}

  // –ì—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π —Å–º–µ–Ω:
  // 1 - –í—Å–µ–≥–¥–∞ —Ö–æ—á–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç—É —Å–º–µ–Ω—É
  // 2 - –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–µ —Ö–æ—á–µ—Ç
  // 3 - –ù–ï –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç—É —Å–º–µ–Ω—É
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞

**–§–∞–π–ª:** `lib/features/work_schedule/services/auto_fill_schedule_service.dart`

#### 4 –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª–∞ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):

1. **‚úÖ –ì–ª–∞–≤–Ω–æ–µ - —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è**
2. **‚úÖ –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É —É—Ç—Ä–æ, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –≤–µ—á–µ—Ä–æ–º**
3. **‚úÖ –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –Ω–æ –Ω–µ–ª—å–∑—è –Ω–∞—Ä—É—à–∞—Ç—å –≤—Ç–æ—Ä–æ–µ**
4. **‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –±–∞–ª–ª–æ–≤**

#### –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤ (Priority Scoring System)

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª: 120 (–ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π)**

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –£—Å–ª–æ–≤–∏–µ | –ë–∞–ª–ª—ã | –ü—Ä–∏–º–µ—Ä |
|-----------|---------|-------|--------|
| **1. –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞** | `preferredShops.contains(shop.id)` | **+10** | –õ—é–±–∏—Ç "–ï—Å—Å–µ–Ω—Ç—É–∫–∏" |
| **2. –ñ–µ–ª–∞–µ–º—ã–π –¥–µ–Ω—å** | `preferredWorkDays.contains("monday")` | **+5** | –õ—é–±–∏—Ç –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ |
| **3. –õ—é–±–∏—Ç —Å–º–µ–Ω—É** | `shiftPreferences[shiftType] == 1` | **+3** | –í—Å–µ–≥–¥–∞ —Ö–æ—á–µ—Ç —É—Ç—Ä–æ |
| **3. –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** | `shiftPreferences[shiftType] == 2` | **+1** | –ú–æ–∂–µ—Ç —É—Ç—Ä–æ–º |
| **3. –ù–ï –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** | `shiftPreferences[shiftType] == 3` | **-10** | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —É—Ç—Ä–æ–º |
| **4. –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞** | `!_hasConflict(...)` | **+2** | –ù–µ —Ä–∞–±–æ—Ç–∞–ª –≤—á–µ—Ä–∞ –≤–µ—á–µ—Ä–æ–º |
| **5. –£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** | `assignedShiftsCount == 0` | **+100** | –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–ª—è –Ω–µ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö |
| **5. –û–±—ã—á–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** | `30 - assignedShiftsCount` | **0-30** | –ß–µ–º –º–µ–Ω—å—à–µ —Å–º–µ–Ω, —Ç–µ–º –≤—ã—à–µ –±–∞–ª–ª |

**–ö–æ–¥ Priority 5 (–£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏):**
```dart
// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
// –ß–µ–º –º–µ–Ω—å—à–µ —Å–º–µ–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω–æ, —Ç–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
final assignedShiftsCount = schedule.entries
    .where((e) => e.employeeId == employee.id)
    .length;

// –≠–∫—Å—Ç—Ä–∞-–±–æ–Ω—É—Å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ —Å–º–µ–Ω (+100)
// –û–±—ã—á–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (–æ—Ç +30 –¥–æ 0)
if (assignedShiftsCount == 0) {
  score += 100; // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
} else {
  final loadBalanceBonus = (30 - assignedShiftsCount).clamp(0, 30);
  score += loadBalanceBonus;
}
```

**–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è –±–∞–ª–ª–æ–≤:**
- 0 —Å–º–µ–Ω: **+100** (–ì–ê–†–ê–ù–¢–ò–Ø –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)
- 1 —Å–º–µ–Ω–∞: +29
- 5 —Å–º–µ–Ω: +25
- 10 —Å–º–µ–Ω: +20
- 15 —Å–º–µ–Ω: +15
- 30+ —Å–º–µ–Ω: 0

#### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (–ø–æ—à–∞–≥–æ–≤–æ)

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
```dart
// –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—ã
final employeesWithPreferences = employees.where((e) =>
  e.preferredWorkDays.isNotEmpty ||
  e.preferredShops.isNotEmpty ||
  e.shiftPreferences.isNotEmpty
).toList();

final employeesWithoutPreferences = employees.where((e) =>
  e.preferredWorkDays.isEmpty &&
  e.preferredShops.isEmpty &&
  e.shiftPreferences.isEmpty
).toList();
```

**2. –¶–∏–∫–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–º–µ–Ω:**
```dart
–î–õ–Ø –ö–ê–ñ–î–û–ì–û –¥–Ω—è –≤ –ø–µ—Ä–∏–æ–¥–µ:
  –î–õ–Ø –ö–ê–ñ–î–û–ì–û –º–∞–≥–∞–∑–∏–Ω–∞:
    –î–õ–Ø –ö–ê–ñ–î–û–ô —Å–º–µ–Ω—ã (—É—Ç—Ä–æ, –≤–µ—á–µ—Ä):

      // –ü–æ–ø—ã—Ç–∫–∞ #1: –° –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø–ú–ò
      selectedEmployee = _selectBestEmployee(
        employees: employeesWithPreferences,
      );

      // –ü–æ–ø—ã—Ç–∫–∞ #2: –ë–ï–ó –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
      if (selectedEmployee == null) {
        selectedEmployee = _selectBestEmployee(
          employees: employeesWithoutPreferences,
        );
      }

      // –ü–æ–ø—ã—Ç–∫–∞ #3: –õ–Æ–ë–û–ô –¥–æ—Å—Ç—É–ø–Ω—ã–π
      if (selectedEmployee == null) {
        selectedEmployee = _selectAnyAvailableEmployee(
          employees: employees,
        );
      }

      // –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–º–µ–Ω—É
      if (selectedEmployee != null) {
        createScheduleEntry();
      }
```

**3. –ú–µ—Ç–æ–¥ `_selectBestEmployee()` - –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:**
```dart
static Employee? _selectBestEmployee({
  required Shop shop,
  required DateTime day,
  required ShiftType shiftType,
  required List<Employee> employees,
  required WorkSchedule schedule,
}) {
  // 1. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–ª—ã –¥–ª—è –í–°–ï–• —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  final scoredEmployees = employees.map((employee) {
    int score = 0;

    // Priority 1: +10 –∑–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –º–∞–≥–∞–∑–∏–Ω
    if (_isPreferredShop(employee, shop)) {
      score += 10;
    }

    // Priority 2: +5 –∑–∞ –∂–µ–ª–∞–µ–º—ã–π –¥–µ–Ω—å
    if (_isPreferredDay(employee, day)) {
      score += 5;
    }

    // Priority 3: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ —Å–º–µ–Ω—ã
    final grade = _getShiftPreferenceGrade(employee, shiftType);
    if (grade == 1) score += 3;      // –í—Å–µ–≥–¥–∞ —Ö–æ—á–µ—Ç
    else if (grade == 2) score += 1; // –ú–æ–∂–µ—Ç
    else if (grade == 3) score -= 10; // –ù–ï –±—É–¥–µ—Ç

    // Priority 4: +2 –∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
    if (!_hasConflict(employee, day, shiftType, schedule)) {
      score += 2;
    }

    // Priority 5: –£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
    final assignedShiftsCount = schedule.entries
        .where((e) => e.employeeId == employee.id)
        .length;

    if (assignedShiftsCount == 0) {
      score += 100; // –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–ª—è –Ω–µ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö
    } else {
      final loadBalanceBonus = (30 - assignedShiftsCount).clamp(0, 30);
      score += loadBalanceBonus;
    }

    return {'employee': employee, 'score': score};
  }).toList();

  // 2. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–ª—ã
  scoredEmployees.removeWhere((item) => item['score'] as int < 0);

  // 3. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É–±—ã–≤–∞–Ω–∏—é –±–∞–ª–ª–æ–≤
  scoredEmployees.sort((a, b) =>
    (b['score'] as int).compareTo(a['score'] as int)
  );

  // 4. –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ, –∫—Ç–æ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
  for (var item in scoredEmployees) {
    final employee = item['employee'] as Employee;
    if (_canWorkShift(employee, day, shiftType, schedule)) {
      return employee;
    }
  }

  return null;
}
```

**4. –ú–µ—Ç–æ–¥ `_canWorkShift()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã:**
```dart
static bool _canWorkShift(
  Employee employee,
  DateTime day,
  ShiftType shiftType,
  WorkSchedule schedule,
) {
  // –ë–õ–û–ö–ò–†–û–í–ö–ê 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç "—É—Ç—Ä–æ –ø–æ—Å–ª–µ –≤–µ—á–µ—Ä–∞"
  if (_hasConflict(employee, day, shiftType, schedule)) {
    return false; // –°–¢–†–û–ì–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê
  }

  // –ë–õ–û–ö–ò–†–û–í–ö–ê 2: –û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ = –æ–¥–Ω–∞ —Å–º–µ–Ω–∞ –≤ –¥–µ–Ω—å
  final hasShift = schedule.entries.any((e) =>
    e.employeeId == employee.id &&
    e.date.year == day.year &&
    e.date.month == day.month &&
    e.date.day == day.day
  );

  if (hasShift) {
    return false; // –ù–ï —Ä–∞–∑—Ä–µ—à–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–º–µ–Ω –≤ –¥–µ–Ω—å
  }

  return true;
}
```

**5. –ú–µ—Ç–æ–¥ `_hasConflict()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ "—É—Ç—Ä–æ –ø–æ—Å–ª–µ –≤–µ—á–µ—Ä–∞":**
```dart
static bool _hasConflict(
  Employee employee,
  DateTime day,
  ShiftType shiftType,
  WorkSchedule schedule,
) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¢–û–õ–¨–ö–û –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–π —Å–º–µ–Ω—ã
  if (shiftType != ShiftType.morning) return false;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–ª –ª–∏ –≤–µ—á–µ—Ä–æ–º –í–ß–ï–†–ê
  final previousDay = day.subtract(const Duration(days: 1));
  return schedule.entries.any((e) =>
    e.employeeId == employee.id &&
    e.date.year == previousDay.year &&
    e.date.month == previousDay.month &&
    e.date.day == previousDay.day &&
    e.shiftType == ShiftType.evening
  );
}
```

**6. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```dart
static List<String> _validateAllEmployeesUsed(
  WorkSchedule schedule,
  List<Employee> employees,
  List<DateTime> days,
) {
  final warnings = <String>[];
  final employeeShiftCounts = <String, int>{};

  // –ü–æ–¥—Å—á–µ—Ç —Å–º–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  for (var employee in employees) {
    final shiftsCount = schedule.entries
        .where((e) => e.employeeId == employee.id && ...)
        .length;

    employeeShiftCounts[employee.name] = shiftsCount;

    if (shiftsCount == 0) {
      warnings.add('‚ö†Ô∏è –°–æ—Ç—Ä—É–¥–Ω–∏–∫ ${employee.name} –Ω–µ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω –≤ –≥—Ä–∞—Ñ–∏–∫–µ');
    }
  }

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –ª–æ–≥–∞—Ö
  Logger.debug('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–º–µ–Ω:');
  Logger.debug('   –í—Å–µ–≥–æ —Å–º–µ–Ω: $totalShifts');
  Logger.debug('   –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: ${avgShifts.toStringAsFixed(1)}');
  Logger.debug('   –ú–∏–Ω–∏–º—É–º: $minShifts, –ú–∞–∫—Å–∏–º—É–º: $maxShifts');
  Logger.debug('   –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å 0 —Å–º–µ–Ω: ${count}');

  return warnings;
}
```

#### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã (—Å—Ü–µ–Ω–∞—Ä–∏–π)

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü–µ—Ä–∏–æ–¥: 1-15 –¥–µ–∫–∞–±—Ä—è 2025 (15 –¥–Ω–µ–π)
- –ú–∞–≥–∞–∑–∏–Ω—ã: 8
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏: 25
- –û–∂–∏–¥–∞–µ–º—ã–µ —Å–º–µ–Ω—ã: 15 √ó 8 √ó 2 = **240 —Å–º–µ–Ω**

**–î–µ–Ω—å 1, –ú–∞–≥–∞–∑–∏–Ω "–ï—Å—Å–µ–Ω—Ç—É–∫–∏", –£—Ç—Ä–æ:**

```
–ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Å –±–∞–ª–ª–∞–º–∏:
1. –ë–æ—Ä–æ–¥–∏–Ω–∞: 10 (–º–∞–≥–∞–∑–∏–Ω) + 5 (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) + 3 (–ª—é–±–∏—Ç —É—Ç—Ä–æ) + 2 (–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞) + 100 (0 —Å–º–µ–Ω) = 120
2. –í–∞—Å—é—Ç–∏–Ω–∞: 10 (–º–∞–≥–∞–∑–∏–Ω) + 1 (–º–æ–∂–µ—Ç —É—Ç—Ä–æ–º) + 2 (–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞) + 100 (0 —Å–º–µ–Ω) = 113
3. –í–µ—Ä–µ—Ç–µ–Ω–Ω–∏–∫–æ–≤: 5 (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) + 3 (–ª—é–±–∏—Ç —É—Ç—Ä–æ) + 2 (–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞) + 100 (0 —Å–º–µ–Ω) = 110

–ü—Ä–æ–≤–µ—Ä–∫–∞ _canWorkShift():
- –ë–æ—Ä–æ–¥–∏–Ω–∞: ‚úÖ –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ‚Üí –ù–ê–ó–ù–ê–ß–ï–ù–ê
```

**–î–µ–Ω—å 1, –ú–∞–≥–∞–∑–∏–Ω "–ï—Å—Å–µ–Ω—Ç—É–∫–∏", –í–µ—á–µ—Ä:**

```
–ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Å –±–∞–ª–ª–∞–º–∏:
1. –ë–æ—Ä–æ–¥–∏–Ω–∞: 120 –±–∞–ª–ª–æ–≤ ‚Üí ‚ùå –ë–õ–û–ö–ò–†–û–í–ê–ù–ê (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è)
2. –í–∞—Å—é—Ç–∏–Ω–∞: 113 –±–∞–ª–ª–æ–≤ ‚Üí ‚úÖ –ù–ê–ó–ù–ê–ß–ï–ù–ê
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ 15 –¥–Ω–µ–π (–æ–∂–∏–¥–∞–µ–º—ã–π):**
- –ú–∏–Ω–∏–º—É–º —Å–º–µ–Ω: 8-9
- –ú–∞–∫—Å–∏–º—É–º —Å–º–µ–Ω: 10-11
- –°—Ä–µ–¥–Ω–µ–µ: 9.6
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å 0 —Å–º–µ–Ω: **0** (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)

#### –ò—Å—Ç–æ—Ä–∏—è —É–ª—É—á—à–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º–∞

**–í–µ—Ä—Å–∏—è 1.0 (–¥–æ —É–ª—É—á—à–µ–Ω–∏–π):**
- –ü—Ä–æ–±–ª–µ–º–∞: 2 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ–ª—É—á–∞–ª–∏ –≤—Å–µ 160 —Å–º–µ–Ω
- –ü—Ä–∏—á–∏–Ω–∞: –ú–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å —É—Ç—Ä–æ –ò –≤–µ—á–µ—Ä –≤ –æ–¥–∏–Ω –¥–µ–Ω—å

**–í–µ—Ä—Å–∏—è 2.0 (Commit 4a3bbbf):**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–º–µ–Ω –≤ –¥–µ–Ω—å
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ë–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–í–µ—Ä—Å–∏—è 2.1 (Commit 017bc3e):**
- –î–æ–±–∞–≤–ª–µ–Ω–æ: Priority 5 —Å –±–æ–Ω—É—Å–æ–º +15 –∑–∞ –Ω–∏–∑–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É
- –î–æ–±–∞–≤–ª–µ–Ω–æ: –í–∞–ª–∏–¥–∞—Ü–∏—è `_validateAllEmployeesUsed()`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 6 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤—Å–µ –µ—â–µ –ø–æ–ª—É—á–∏–ª–∏ 0 —Å–º–µ–Ω

**–í–µ—Ä—Å–∏—è 2.2 (—Ç–µ–∫—É—â–∞—è):**
- –£—Å–∏–ª–µ–Ω–æ: Priority 5 —Å –±–æ–Ω—É—Å–æ–º +100 –¥–ª—è –Ω–µ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö
- –£—Å–∏–ª–µ–Ω–æ: Priority 5 —Å –±–æ–Ω—É—Å–æ–º –¥–æ +30 –¥–ª—è –º–∞–ª–æ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö
- –†–µ–∑—É–ª—å—Ç–∞—Ç: **–í–°–ï** 25 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ–ª—É—á–∞—é—Ç —Å–º–µ–Ω—ã

---

## üìÑ –°–∏—Å—Ç–µ–º–∞ –†–ö–û (–†–∞—Å—Ö–æ–¥–Ω—ã–µ –∫–∞—Å—Å–æ–≤—ã–µ –æ—Ä–¥–µ—Ä–∞)

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**RKO:**
```dart
class RKO {
  String id;
  String employeeName;
  String shopAddress;
  DateTime date;
  int amount;
  String category;
  String documentNumber;
  String pdfFileName;
  String pdfUrl;
  DateTime createdAt;
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `lib/features/rko/services/rko_pdf_service.dart` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
- `lib/features/rko/services/rko_reports_service.dart` - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- `lib/features/rko/services/rko_service.dart` - –û—Å–Ω–æ–≤–Ω–æ–π API

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π

**–û—à–∏–±–∫–∞ 1 (Commit 30bb694):**
```
MissingPluginException(
  No implementation found for method getTemporaryDirectory
  on channel plugins.flutter.io/path_provider
)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–ª–∞–≥–∏–Ω `path_provider` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ Flutter Web
- –ë—Ä–∞—É–∑–µ—Ä—ã –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ú–µ—Ç–æ–¥—ã `getTemporaryDirectory()` –∏ `getApplicationDocumentsDirectory()` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

**–†–µ—à–µ–Ω–∏–µ: –ö–ª–∞—Å—Å `_MemoryFile`**
```dart
/// –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
/// –ò–º–∏—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å File, –Ω–æ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏
class _MemoryFile implements File {
  final String _path;
  final Uint8List _bytes;

  _MemoryFile(String path, List<int> bytes)
      : _path = path,
        _bytes = bytes is Uint8List ? bytes : Uint8List.fromList(bytes);

  @override
  String get path => _path;

  @override
  Future<Uint8List> readAsBytes() async => _bytes;

  @override
  Uint8List readAsBytesSync() => _bytes;

  @override
  dynamic noSuchMethod(Invocation invocation) => super.noSuchMethod(invocation);
}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ `generateRKOFromDocx()`:**
```dart
if (response.statusCode == 200) {
  final fileName = generateFileName(...);

  if (kIsWeb) {
    // –î–ª—è –≤–µ–± —Å–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç–∏
    final virtualFile = _MemoryFile(fileName, response.bodyBytes);
    return virtualFile; // ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
  } else {
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
    final directory = await getTemporaryDirectory();
    final file = File(path.join(directory.path, fileName));
    await file.writeAsBytes(response.bodyBytes);
    return file;
  }
}
```

**–û—à–∏–±–∫–∞ 2 (Commit 5ef9fa4):**
```
Unsupported operation: MultipartFile is only supported
where dart:io is available.
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- `MultipartFile.fromPath()` —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ù–∞ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤—ã—Ö –ø—É—Ç–µ–π (–≤—Å–µ –≤ –ø–∞–º—è—Ç–∏)

**–†–µ—à–µ–Ω–∏–µ: –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**
```dart
// –í uploadRKO()
if (kIsWeb) {
  // –ß–∏—Ç–∞–µ–º –±–∞–π—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å _MemoryFile)
  final bytes = await pdfFile.readAsBytes();
  request.files.add(
    http.MultipartFile.fromBytes(
      'docx',
      bytes,
      filename: fileName, // –í–∞–∂–Ω–æ: —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è
    ),
  );
} else {
  // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
  request.files.add(
    await http.MultipartFile.fromPath('docx', pdfFile.path),
  );
}
```

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è –†–ö–û

**1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –†–ö–û —á–µ—Ä–µ–∑ UI**
```dart
// –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫: "–ë–æ—Ä–æ–¥–∏–Ω–∞ –ï–ª–µ–Ω–∞"
- –ú–∞–≥–∞–∑–∏–Ω: "–ê—Ä–∞–±–∏–∫–∞ –ï—Å—Å–µ–Ω—Ç—É–∫–∏"
- –î–∞—Ç–∞: 2025-12-29
- –°—É–º–º–∞: 5000
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: "–ó–∞–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤"
```

**2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
```dart
final pdfFile = await RKOPDFService.generateRKOFromDocx(
  employeeName: employeeName,
  shopAddress: shopAddress,
  date: date,
  amount: amount,
  category: category,
);
```

**3. –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-–∑–∞–≤–∏—Å–∏–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```dart
// WEB:
Server ‚Üí PDF bytes ‚Üí _MemoryFile(fileName, bytes) ‚Üí –≤–æ–∑–≤—Ä–∞—Ç

// MOBILE:
Server ‚Üí PDF bytes ‚Üí File system ‚Üí –≤–æ–∑–≤—Ä–∞—Ç File
```

**4. –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
```dart
final success = await RKOReportsService.uploadRKO(
  pdfFile: pdfFile,
  employeeName: employeeName,
  shopAddress: shopAddress,
  date: date,
  amount: amount,
  category: category,
);
```

**5. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª**
```javascript
// /root/loyalty-proxy/routes/rko.js
const fileName = `${sanitized_employee}_${sanitized_shop}_${dateStr}.docx`;
const filePath = path.join(RKO_REPORTS_DIR, fileName);
fs.writeFileSync(filePath, fileBuffer);
```

**6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
```javascript
const rkoData = {
  id: uuidv4(),
  employeeName,
  shopAddress,
  date: date.toISOString(),
  amount,
  category,
  documentNumber: generatedNumber,
  pdfFileName: fileName,
  pdfUrl: `${BASE_URL}/rko-reports/${fileName}`,
  createdAt: new Date().toISOString(),
};

rkoList.push(rkoData);
fs.writeFileSync(RKO_DB_PATH, JSON.stringify(rkoList, null, 2));
```

---

## üìä –°–∏—Å—Ç–µ–º–∞ KPI (Key Performance Indicators)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

**–ë—ã–ª–æ:** 1 —Ñ–∞–π–ª `kpi_service.dart` (1200 —Å—Ç—Ä–æ–∫)

**–°—Ç–∞–ª–æ:** 5 —Ñ–∞–π–ª–æ–≤

#### 1. kpi_service.dart (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, ~150 —Å—Ç—Ä–æ–∫)
```dart
class KpiService {
  static Future<Map<String, dynamic>> getKpiData({
    required DateTime startDate,
    required DateTime endDate,
    String? shopAddress,
  }) async {
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à
    final cached = await KpiCacheService.get(startDate, endDate, shopAddress);
    if (cached != null) return cached;

    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    final data = await KpiAggregationService.aggregate(
      startDate: startDate,
      endDate: endDate,
      shopAddress: shopAddress,
    );

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
    await KpiCacheService.save(data, startDate, endDate, shopAddress);

    return data;
  }
}
```

#### 2. kpi_aggregation_service.dart (~400 —Å—Ç—Ä–æ–∫)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ attendance, orders, rko
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- –ü–æ–¥—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
```dart
class KpiMetrics {
  // –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
  int totalAttendance;
  int morningShifts;
  int eveningShifts;

  // –ó–∞–∫–∞–∑—ã
  int totalOrders;
  double totalRevenue;
  double averageCheck;

  // –†–ö–û
  int totalRko;
  double totalExpenses;

  // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  double revenuePerShift;
  double ordersPerShift;
}
```

#### 3. kpi_cache_service.dart (~100 —Å—Ç—Ä–æ–∫)
```dart
class KpiCacheService {
  static const Duration cacheDuration = Duration(minutes: 5);

  static Future<Map<String, dynamic>?> get(
    DateTime startDate,
    DateTime endDate,
    String? shopAddress,
  ) async {
    final key = _generateCacheKey(startDate, endDate, shopAddress);
    final cached = await CacheManager.get(key);

    if (cached != null && _isValid(cached)) {
      return cached['data'];
    }

    return null;
  }

  static Future<void> save(
    Map<String, dynamic> data,
    DateTime startDate,
    DateTime endDate,
    String? shopAddress,
  ) async {
    final key = _generateCacheKey(startDate, endDate, shopAddress);
    await CacheManager.set(key, {
      'data': data,
      'timestamp': DateTime.now().toIso8601String(),
    });
  }
}
```

#### 4. kpi_normalizers.dart (~150 —Å—Ç—Ä–æ–∫)
```dart
class KpiNormalizers {
  static String normalizeEmployeeName(String name) {
    return name.trim().toLowerCase().replaceAll(RegExp(r'\s+'), ' ');
  }

  static String normalizeShopAddress(String address) {
    return address.toLowerCase().trim().replaceAll(RegExp(r'\s+'), ' ');
  }

  static DateTime normalizeDate(DateTime date) {
    return DateTime(date.year, date.month, date.day);
  }
}
```

#### 5. kpi_filters.dart (~200 —Å—Ç—Ä–æ–∫)
```dart
class KpiFilters {
  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
  static List<T> filterByDateRange<T>(
    List<T> items,
    DateTime startDate,
    DateTime endDate,
    DateTime Function(T) getDate,
  ) {
    return items.where((item) {
      final date = getDate(item);
      return !date.isBefore(startDate) && !date.isAfter(endDate);
    }).toList();
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
  static List<T> filterByEmployee<T>(
    List<T> items,
    String employeeName,
    String Function(T) getName,
  ) {
    final normalized = KpiNormalizers.normalizeEmployeeName(employeeName);
    return items.where((item) {
      final itemName = KpiNormalizers.normalizeEmployeeName(getName(item));
      return itemName == normalized;
    }).toList();
  }

  // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —É—Ç—Ä–æ/–≤–µ—á–µ—Ä
  static Map<String, List<T>> splitByShift<T>(
    List<T> items,
    ShiftType Function(T) getShiftType,
  ) {
    return {
      'morning': items.where((item) => getShiftType(item) == ShiftType.morning).toList(),
      'evening': items.where((item) => getShiftType(item) == ShiftType.evening).toList(),
    };
  }
}
```

---

## üåê –†–∞–±–æ—Ç–∞ —Å HTTP –∏ API

### BaseHttpService

**–§–∞–π–ª:** `lib/core/services/base_http_service.dart`

**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ 30+ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–ë—ã–ª–æ (–≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ ~60 —Å—Ç—Ä–æ–∫):**
```dart
class ClientService {
  static const String serverUrl = 'https://arabica26.ru';
  static const String baseUrl = '$serverUrl/api/clients';

  static Future<List<Client>> getClients() async {
    try {
      final response = await http.get(Uri.parse(baseUrl))
          .timeout(const Duration(seconds: 15));
      if (response.statusCode == 200) {
        final result = jsonDecode(response.body);
        if (result['success'] == true) {
          final clientsJson = result['clients'] as List<dynamic>;
          return clientsJson.map((json) => Client.fromJson(json)).toList();
        }
      }
      return [];
    } catch (e) {
      Logger.error('Error', e);
      return [];
    }
  }
}
```

**–°—Ç–∞–ª–æ (~12 —Å—Ç—Ä–æ–∫):**
```dart
import '../../../core/services/base_http_service.dart';
import '../../../core/constants/api_constants.dart';
import '../models/client_model.dart';

class ClientService {
  static Future<List<Client>> getClients() async {
    return await BaseHttpService.getList<Client>(
      endpoint: ApiConstants.clientsEndpoint,
      fromJson: (json) => Client.fromJson(json),
      listKey: 'clients',
    );
  }
}
```

**–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞: ~80%!**

### –ú–µ—Ç–æ–¥—ã BaseHttpService

#### 1. getList - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
```dart
static Future<List<T>> getList<T>({
  required String endpoint,
  required T Function(Map<String, dynamic>) fromJson,
  required String listKey,
  Map<String, String>? queryParams,
  Duration? timeout,
}) async {
  final uri = Uri.parse('${ApiConstants.serverUrl}$endpoint')
      .replace(queryParameters: queryParams);

  final response = await http
      .get(uri)
      .timeout(timeout ?? ApiConstants.defaultTimeout);

  if (response.statusCode == 200) {
    final result = jsonDecode(response.body);
    if (result['success'] == true) {
      final items = result[listKey] as List<dynamic>;
      return items
          .map((json) => fromJson(json as Map<String, dynamic>))
          .toList();
    }
  }

  return [];
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```dart
// –ö–ª–∏–µ–Ω—Ç—ã
final clients = await BaseHttpService.getList<Client>(
  endpoint: '/api/clients',
  fromJson: Client.fromJson,
  listKey: 'clients',
);

// –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
final employees = await BaseHttpService.getList<Employee>(
  endpoint: '/api/employees',
  fromJson: Employee.fromJson,
  listKey: 'employees',
);
```

#### 2. get - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
```dart
static Future<T?> get<T>({
  required String endpoint,
  required T Function(Map<String, dynamic>) fromJson,
  required String itemKey,
  Duration? timeout,
}) async { /* ... */ }
```

#### 3. post - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```dart
static Future<T?> post<T>({
  required String endpoint,
  required Map<String, dynamic> body,
  required T Function(Map<String, dynamic>) fromJson,
  required String itemKey,
  Duration? timeout,
}) async { /* ... */ }
```

#### 4. put - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```dart
static Future<T?> put<T>({ /* ... */ }) async { /* ... */ }
```

#### 5. delete - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```dart
static Future<bool> delete({
  required String endpoint,
  Duration? timeout,
}) async { /* ... */ }
```

### API Constants

**–§–∞–π–ª:** `lib/core/constants/api_constants.dart`

```dart
class ApiConstants {
  // URL
  static const String serverUrl = 'https://arabica26.ru';

  // Timeouts
  static const Duration shortTimeout = Duration(seconds: 10);
  static const Duration defaultTimeout = Duration(seconds: 15);
  static const Duration longTimeout = Duration(seconds: 30);
  static const Duration uploadTimeout = Duration(seconds: 120);

  // Headers
  static const Map<String, String> jsonHeaders = {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  };

  // Endpoints
  static const String attendanceEndpoint = '/api/attendance';
  static const String clientsEndpoint = '/api/clients';
  static const String employeesEndpoint = '/api/employees';
  static const String menuEndpoint = '/api/menu';
  static const String ordersEndpoint = '/api/orders';
  static const String recipesEndpoint = '/api/recipes';
  static const String reviewsEndpoint = '/api/reviews';
  static const String rkoEndpoint = '/api/rko';
  static const String shopsEndpoint = '/api/shops';
  static const String workScheduleEndpoint = '/api/work-schedule';
  static const String kpiEndpoint = '/api/kpi';
}
```

**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π:** 24 ‚Üí 1

---

## üè™ –°–∏—Å—Ç–µ–º–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤ (Shops)

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**Shop:**
```dart
class Shop {
  String id;
  String name;
  String address;
  double latitude;
  double longitude;
  bool isActive;
}
```

**ShopSettings:**
```dart
class ShopSettings {
  String shopAddress;
  TimeOfDay morningStart;
  TimeOfDay morningEnd;
  TimeOfDay eveningStart;
  TimeOfDay eveningEnd;
  double checkInRadius;  // –†–∞–¥–∏—É—Å –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫ (–º–µ—Ç—Ä—ã)
}
```

### –û—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (Attendance)

**–§–∞–π–ª:** `lib/features/attendance/services/attendance_service.dart`

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–º–µ–Ω—ã:**
```dart
static ShiftType determineShift(DateTime time) {
  final hour = time.hour;

  if (hour < AppConstants.eveningBoundaryHour) {
    return ShiftType.morning;
  } else {
    return ShiftType.evening;
  }
}

// AppConstants.eveningBoundaryHour = 15
// –î–æ 15:00 ‚Üí morning
// –ü–æ—Å–ª–µ 15:00 ‚Üí evening
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:**
```dart
static bool isWithinCheckInRadius(
  double userLat,
  double userLng,
  double shopLat,
  double shopLng,
  double radius,
) {
  final distance = _calculateDistance(userLat, userLng, shopLat, shopLng);
  return distance <= radius;
}

// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞ Haversine –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
```

**–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏:**
```dart
static Future<bool> checkIn({
  required String employeeName,
  required String shopAddress,
  required double latitude,
  required double longitude,
}) async {
  // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–¥–∏—É—Å
  final shop = await ShopService.getShopByAddress(shopAddress);
  final inRadius = isWithinCheckInRadius(
    latitude, longitude,
    shop.latitude, shop.longitude,
    shop.checkInRadius ?? AppConstants.checkInRadius,
  );

  if (!inRadius) {
    throw Exception('–í—ã —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞');
  }

  // 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–º–µ–Ω—É
  final shiftType = determineShift(DateTime.now());

  // 3. –°–æ–∑–¥–∞—Ç—å –æ—Ç–º–µ—Ç–∫—É
  final attendance = AttendanceRecord(
    id: '',
    employeeName: employeeName,
    shopAddress: shopAddress,
    date: DateTime.now(),
    shiftType: shiftType,
    latitude: latitude,
    longitude: longitude,
  );

  // 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  return await BaseHttpService.post(/* ... */);
}
```

---

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (Clients)

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**Client:**
```dart
class Client {
  String phone;           // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  String name;
  String clientName;
  bool isAdmin;
  String employeeName;    // –ö—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª
  DateTime? updatedAt;
}
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

**–§–∞–π–ª:** `lib/core/utils/phone_normalizer.dart`

```dart
class PhoneNormalizer {
  static String normalize(String phone) {
    // –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã, +, —Å–∫–æ–±–∫–∏, –¥–µ—Ñ–∏—Å—ã
    return phone.replaceAll(RegExp(r'[\s\+\(\)\-]'), '');
  }
}

// –ü—Ä–∏–º–µ—Ä—ã:
// "+7 905 444 32 24" ‚Üí "79054443224"
// "8 (905) 444-32-24" ‚Üí "89054443224"
// "7-905-444-32-24" ‚Üí "79054443224"
```

### –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**–°–∏—Å—Ç–µ–º–∞ —á–∞—à–µ–∫ (Loyalty Cups):**
```dart
class LoyaltyService {
  static const int cupsForFreeItem = 9; // 9 —á–∞—à–µ–∫ ‚Üí –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä

  static Future<int> getCupsCount(String phone) async {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –±–∞–∑—ã
  }

  static Future<void> addCup(String phone) async {
    final currentCups = await getCupsCount(phone);
    final newCups = (currentCups + 1) % cupsForFreeItem;
    // –ï—Å–ª–∏ –±—ã–ª–æ 8, —Å—Ç–∞–Ω–µ—Ç 0 (–ø–æ–ª—É—á–∏–ª –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä)
  }

  static Future<void> redeemReward(String phone) async {
    // –û–±–Ω—É–ª–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —á–∞—à–µ–∫
    await setCupsCount(phone, 0);
  }
}
```

**–í–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞—à–µ–∫:**
```dart
class LoyaltyCupWidget extends StatelessWidget {
  final int filledCups;

  @override
  Widget build(BuildContext context) {
    return Row(
      children: List.generate(9, (index) {
        return Icon(
          index < filledCups ? Icons.coffee : Icons.coffee_outlined,
          color: index < filledCups ? Colors.brown : Colors.grey,
        );
      }),
    );
  }
}
```

### –ß–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

**ClientDialogService:**
```dart
class ClientDialogService {
  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É
  static Future<bool> sendMessage({
    required String phone,
    required String message,
    required String senderName,
  }) async {
    final messageData = ClientMessage(
      id: '',
      phone: phone,
      message: message,
      senderName: senderName,
      timestamp: DateTime.now(),
      isFromClient: false, // –û—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    );

    return await BaseHttpService.post(/* ... */);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  static Future<List<ClientMessage>> getMessages(String phone) async {
    return await BaseHttpService.getList<ClientMessage>(
      endpoint: '/api/client-messages/$phone',
      fromJson: ClientMessage.fromJson,
      listKey: 'messages',
    );
  }
}
```

---

## üîß –£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### Logger

**–§–∞–π–ª:** `lib/core/utils/logger.dart`

```dart
class Logger {
  static void debug(String message, [dynamic error]) {
    print('üîµ DEBUG: $message');
    if (error != null) {
      print('   Error: $error');
    }
  }

  static void error(String message, [dynamic error]) {
    print('üî¥ ERROR: $message');
    if (error != null) {
      print('   Error: $error');
    }
  }

  static void info(String message) {
    print('‚ÑπÔ∏è INFO: $message');
  }

  static void success(String message) {
    print('‚úÖ SUCCESS: $message');
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```dart
Logger.debug('üîÑ –ù–∞—á–∞–ª–æ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è');
Logger.debug('   –ü–µ—Ä–∏–æ–¥: ${startDate} - ${endDate}');
Logger.debug('   –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${employees.length}');

Logger.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', e);

Logger.success('‚úÖ –ì—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω: 240 —Å–º–µ–Ω');
```

### CacheManager

**–§–∞–π–ª:** `lib/core/utils/cache_manager.dart`

```dart
class CacheManager {
  static final Map<String, dynamic> _cache = {};

  static Future<dynamic> get(String key) async {
    return _cache[key];
  }

  static Future<void> set(String key, dynamic value) async {
    _cache[key] = value;
  }

  static Future<void> clear(String key) async {
    _cache.remove(key);
  }

  static Future<void> clearAll() async {
    _cache.clear();
  }
}
```

---

## üñ•Ô∏è –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (Node.js)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–§–∞–π–ª:** `/root/loyalty-proxy/index.js` (~100 —Å—Ç—Ä–æ–∫)

```javascript
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');
const config = require('./config/constants');
const { errorMiddleware } = require('./middleware/errorHandler');

const app = express();

// Middleware
app.use(cors());
app.use(bodyParser.json({ limit: '50mb' }));
app.use(bodyParser.urlencoded({ limit: '50mb', extended: true }));

// Routes
app.use('/api/attendance', require('./routes/attendance'));
app.use('/api/clients', require('./routes/clients'));
app.use('/api/employees', require('./routes/employees'));
app.use('/api/menu', require('./routes/menu'));
app.use('/api/orders', require('./routes/orders'));
app.use('/api/recount-reports', require('./routes/recount'));
app.use('/api/rko', require('./routes/rko'));
app.use('/api/shops', require('./routes/shops'));
app.use('/api/work-schedule', require('./routes/workSchedule'));

// Static files
app.use('/shift-photos', express.static(config.PATHS.SHIFT_PHOTOS));
app.use('/employee-photos', express.static(config.PATHS.EMPLOYEE_PHOTOS));

// Error handling
app.use(errorMiddleware);

// Start server
app.listen(config.PORT, () => {
  console.log(`Server listening on port ${config.PORT}`);
});
```

### Config Constants

**–§–∞–π–ª:** `/root/loyalty-proxy/config/constants.js`

```javascript
module.exports = {
  PATHS: {
    SHIFT_PHOTOS: '/var/www/shift-photos',
    RECOUNT_REPORTS: '/var/www/recount-reports',
    ATTENDANCE: '/var/www/attendance',
    EMPLOYEE_PHOTOS: '/var/www/employee-photos',
    EMPLOYEE_REGISTRATIONS: '/var/www/employee-registrations',
    SHOP_SETTINGS: '/var/www/shop-settings',
    RKO_REPORTS: '/var/www/rko-reports',
    WORK_SCHEDULES: '/var/www/work-schedules',
    WORK_SCHEDULE_TEMPLATES: '/var/www/work-schedule-templates',
  },

  URLS: {
    BASE_URL: 'https://arabica26.ru',
    SHIFT_PHOTOS_URL: 'https://arabica26.ru/shift-photos/',
    EMPLOYEE_PHOTOS_URL: 'https://arabica26.ru/employee-photos/',
  },

  LIMITS: {
    FILE_SIZE: 10 * 1024 * 1024, // 10MB
    MAX_RKOS_PER_EMPLOYEE: 150,
    MAX_RKOS_PER_SHOP: 6,
    RECENT_RKOS_LIMIT: 25,
    MAX_DOCUMENT_NUMBER: 50000,
  },

  PORT: 3000,
};
```

### Error Handler Middleware

**–§–∞–π–ª:** `/root/loyalty-proxy/middleware/errorHandler.js`

```javascript
function asyncHandler(fn) {
  return (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
}

function errorMiddleware(err, req, res, next) {
  console.error('‚ùå Error:', err);

  const statusCode = err.statusCode || 500;
  const message = err.message || 'Internal server error';

  res.status(statusCode).json({
    success: false,
    error: message,
  });
}

module.exports = {
  asyncHandler,
  errorMiddleware,
};
```

### File System Utils

**–§–∞–π–ª:** `/root/loyalty-proxy/utils/fileSystem.js`

```javascript
const fs = require('fs');
const path = require('path');

function ensureDirectoryExists(directory) {
  if (!fs.existsSync(directory)) {
    fs.mkdirSync(directory, { recursive: true });
  }
}

function sanitizeFileName(fileName) {
  return fileName.replace(/[^a-zA-Z0-9_\-\.]/g, '_');
}

function readJSONFile(filePath) {
  const content = fs.readFileSync(filePath, 'utf8');
  return JSON.parse(content);
}

function writeJSONFile(filePath, data) {
  fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf8');
}

module.exports = {
  ensureDirectoryExists,
  sanitizeFileName,
  readJSONFile,
  writeJSONFile,
};
```

### Data Filter Utils

**–§–∞–π–ª:** `/root/loyalty-proxy/utils/dataFilter.js`

```javascript
function filterByEmployeeName(records, employeeName) {
  if (!employeeName) return records;
  return records.filter(r =>
    r.employeeName && r.employeeName.includes(employeeName)
  );
}

function filterByShopAddress(records, shopAddress) {
  if (!shopAddress) return records;
  return records.filter(r =>
    r.shopAddress && r.shopAddress.includes(shopAddress)
  );
}

function filterByDate(records, date, dateField = 'createdAt') {
  if (!date) return records;
  const filterDate = new Date(date);
  return records.filter(r => {
    const recordDate = new Date(r[dateField]);
    return recordDate.toDateString() === filterDate.toDateString();
  });
}

function sortByDate(records, dateField = 'createdAt', order = 'desc') {
  return records.sort((a, b) => {
    const dateA = new Date(a[dateField] || 0);
    const dateB = new Date(b[dateField] || 0);
    return order === 'desc' ? dateB - dateA : dateA - dateB;
  });
}

module.exports = {
  filterByEmployeeName,
  filterByShopAddress,
  filterByDate,
  sortByDate,
};
```

### –ü—Ä–∏–º–µ—Ä —Ä–æ—É—Ç–∞: Clients

**–§–∞–π–ª:** `/root/loyalty-proxy/routes/clients.js`

```javascript
const express = require('express');
const router = express.Router();
const { asyncHandler } = require('../middleware/errorHandler');
const { ensureDirectoryExists, readJSONFile, writeJSONFile } = require('../utils/fileSystem');
const config = require('../config/constants');
const path = require('path');
const fs = require('fs');

const clientsDir = '/var/www/clients';

// GET /api/clients - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
router.get('/', asyncHandler(async (req, res) => {
  ensureDirectoryExists(clientsDir);

  const files = fs.readdirSync(clientsDir).filter(f => f.endsWith('.json'));
  const clients = files.map(file => {
    const filePath = path.join(clientsDir, file);
    return readJSONFile(filePath);
  });

  res.json({ success: true, clients });
}));

// POST /api/clients - —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
router.post('/', asyncHandler(async (req, res) => {
  const { phone, name, clientName, isAdmin, employeeName } = req.body;

  if (!phone) {
    return res.status(400).json({
      success: false,
      error: '–¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω',
    });
  }

  const normalizedPhone = phone.replace(/[^0-9]/g, '');
  const clientFile = path.join(clientsDir, `${normalizedPhone}.json`);

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å isAdmin –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  let preservedIsAdmin = isAdmin || false;
  if (fs.existsSync(clientFile)) {
    const existingClient = readJSONFile(clientFile);
    preservedIsAdmin = existingClient.isAdmin || false;
  }

  const clientData = {
    phone: normalizedPhone,
    name: name || clientName || '',
    clientName: clientName || name || '',
    isAdmin: preservedIsAdmin,
    employeeName: employeeName || '',
    updatedAt: new Date().toISOString(),
  };

  ensureDirectoryExists(clientsDir);
  writeJSONFile(clientFile, clientData);

  console.log(`‚úÖ Client saved: ${clientData.name} (${clientData.phone})`);

  res.json({
    success: true,
    client: clientData,
  });
}));

module.exports = router;
```

---

## üìù –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (Git commits)

#### 1. Commit 30bb694 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –†–ö–û –Ω–∞ –≤–µ–±
```
üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –†–ö–û –Ω–∞ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

- –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å _MemoryFile –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è PDF –≤ –ø–∞–º—è—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã generateRKOFromDocx() –∏ generateRKO()
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ kIsWeb –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
```

#### 2. Commit 5ef9fa4 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –†–ö–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```
üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –†–ö–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ kIsWeb –≤ uploadRKO()
- –î–ª—è –≤–µ–±: MultipartFile.fromBytes()
- –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö: MultipartFile.fromPath()
```

#### 3. Commit e2c9901 - –°–∫—Ä—ã—Ç–∏–µ Reports –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```
üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ Reports —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

- –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ main_menu_page.dart
- –¢–µ–ø–µ—Ä—å Reports –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
```

#### 4. Commit 4a3bbbf - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
```
üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –æ–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ = –æ–¥–Ω–∞ —Å–º–µ–Ω–∞ –≤ –¥–µ–Ω—å

- –û–±–Ω–æ–≤–ª–µ–Ω _canWorkShift() –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–º–µ–Ω –≤ –¥–µ–Ω—å
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–µ–π –≤—Å–µ—Ö —Å–º–µ–Ω —É 2 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```

#### 5. Commit 017bc3e - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
```
‚ú® –£–ª—É—á—à–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

- –î–æ–±–∞–≤–ª–µ–Ω –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (+15 –±–∞–ª–ª–æ–≤)
- –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ _validateAllEmployeesUsed()
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
```

#### 6. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è - –£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
```
‚ú® –£—Å–∏–ª–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞

- –£–≤–µ–ª–∏—á–µ–Ω –±–æ–Ω—É—Å –¥–æ +100 –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ —Å–º–µ–Ω
- –£–≤–µ–ª–∏—á–µ–Ω –æ–±—ã—á–Ω—ã–π –±–æ–Ω—É—Å –¥–æ +30 (–±—ã–ª–æ +15)
- –ì–∞—Ä–∞–Ω—Ç–∏—è –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö 25 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ best practices

### 1. –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-–∑–∞–≤–∏—Å–∏–º—ã–π –∫–æ–¥
```dart
import 'package:flutter/foundation.dart' show kIsWeb;

if (kIsWeb) {
  // –ö–æ–¥ –¥–ª—è –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  final memoryFile = _MemoryFile(fileName, bytes);
} else {
  // –ö–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
  final file = File(path);
}
```

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç
```dart
// ‚ùå –ü–õ–û–•–û: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ
class ClientService {
  static const String serverUrl = 'https://arabica26.ru';
}

// ‚úÖ –•–û–†–û–®–û: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è
import '../../../core/constants/api_constants.dart';

class ClientService {
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ApiConstants.serverUrl
}
```

### 3. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
```dart
// ‚ùå –ü–õ–û–•–û: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
class ClientService {
  static Future<List<Client>> getClients() async {
    // 60 —Å—Ç—Ä–æ–∫ HTTP –∫–æ–¥–∞
  }
}

// ‚úÖ –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BaseHttpService
class ClientService {
  static Future<List<Client>> getClients() async {
    return await BaseHttpService.getList<Client>(
      endpoint: ApiConstants.clientsEndpoint,
      fromJson: Client.fromJson,
      listKey: 'clients',
    );
  }
}
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```dart
// ‚ùå –ü–õ–û–•–û: print –≤–µ–∑–¥–µ
print('Loaded clients');

// ‚úÖ –•–û–†–û–®–û: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π Logger
Logger.debug('üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${clients.length}');
Logger.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', e);
Logger.success('‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```dart
// ‚ùå –ü–õ–û–•–û: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
try {
  final data = await loadData();
} catch (e) {
  // –ü—É—Å—Ç–æ–π catch
}

// ‚úÖ –•–û–†–û–®–û: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
try {
  final data = await loadData();
  return data;
} catch (e) {
  Logger.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', e);
  return [];
}
```

### 6. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```dart
// ‚ùå –ü–õ–û–•–û: –ü—Ä—è–º–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
if (employee.name == searchName) { }

// ‚úÖ –•–û–†–û–®–û: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
final normalizedSearch = KpiNormalizers.normalizeEmployeeName(searchName);
final normalizedEmployee = KpiNormalizers.normalizeEmployeeName(employee.name);
if (normalizedEmployee == normalizedSearch) { }
```

---

## üîç –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –†–ö–û –Ω–∞ –≤–µ–±
**–ü—Ä–∏—á–∏–Ω–∞:** `path_provider` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ–±
**–†–µ—à–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å `_MemoryFile` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–º–µ–Ω
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
**–†–µ—à–µ–Ω–∏–µ:** Priority 5 —Å –±–æ–Ω—É—Å–æ–º +100 –¥–ª—è –Ω–µ–∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —É—Ç—Ä–æ –ø–æ—Å–ª–µ –≤–µ—á–µ—Ä–∞
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ú–µ—Ç–æ–¥ `_hasConflict()` —Å —Å—Ç—Ä–æ–≥–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —É—Ç—Ä–æ –ò –≤–µ—á–µ—Ä –≤ –æ–¥–∏–Ω –¥–µ–Ω—å
**–ü—Ä–∏—á–∏–Ω–∞:** `_canWorkShift()` —Ä–∞–∑—Ä–µ—à–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–º–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `hasShift` —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ serverUrl –≤ 24 —Å–µ—Ä–≤–∏—Å–∞—Ö
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
**–†–µ—à–µ–Ω–∏–µ:** `ApiConstants.serverUrl` –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### Flutter Client
- **–§–∞–π–ª–æ–≤:** ~143 (–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –≤ feature-based —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
- **–°–µ—Ä–≤–∏—Å–æ–≤:** 30 (–≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç BaseHttpService)
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞:** ~40% –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ serverUrl:** 24 ‚Üí 1

### Node.js Server
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–¥–æ):** 1839 –≤ index.js
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–ø–æ—Å–ª–µ):** ~100 –≤ index.js + –º–æ–¥—É–ª–∏
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ:** ~50%
- **–ú–æ–¥—É–ª–µ–π:** 15 (routes + utils + middleware)

### Work Schedule Algorithm
- **–í–µ—Ä—Å–∏—è:** 2.2 (—Å —É—Å–∏–ª–µ–Ω–Ω–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª:** 120
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:** 5
- **–ì–∞—Ä–∞–Ω—Ç–∏—è:** –í—Å–µ 25 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** JSON —Ñ–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –∏–ª–∏ MongoDB

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** JWT —Ç–æ–∫–µ–Ω—ã —Å refresh –º–µ—Ö–∞–Ω–∏–∑–º–æ–º

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** In-memory –∫—ç—à (—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Redis –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫—ç—à–∞

### 4. WebSocket –¥–ª—è —á–∞—Ç–∞
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** HTTP polling
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Unit —Ç–µ—Å—Ç—ã + Integration —Ç–µ—Å—Ç—ã

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ü—Ä–æ–µ–∫—Ç:** Arabica2026 Coffee Shop Management System
**–°–µ—Ä–≤–µ—Ä:** https://arabica26.ru
**–¢–µ–ª–µ—Ñ–æ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:** 79054443224
**–í–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** refactoring/full-restructure

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2025-12-29
**–í–µ—Ä—Å–∏—è:** 1.0
**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

---

## üéì –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

### –î–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ä–∞–∑–¥–µ–ª "–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ"
2. –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
3. –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –∫–ª—é—á–µ–≤—ã–º–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏
4. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ Work Schedule Algorithm (—Å–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å)

### –î–ª—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (—Å–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è):
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç
2. –û–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ "–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è"
3. –ü–æ–º–Ω–∏—Ç—å –ø—Ä–æ 4 –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
4. –£—á–∏—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ-–∑–∞–≤–∏—Å–∏–º—ã–π –∫–æ–¥ (kIsWeb)

### –î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. –û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–∏ –ª—é–±—ã—Ö –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
2. –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á
3. –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

---

**–ö–û–ù–ï–¶ –î–û–ö–£–ú–ï–ù–¢–ê**
