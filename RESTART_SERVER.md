# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é Google Apps Script

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

–Ø –∏—Å–ø—Ä–∞–≤–∏–ª –ø—Ä–æ–±–ª–µ–º—É —Å —Ä–µ–≥–∏—Å—Ç—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏—è `getUserRole` –≤ Google Apps Script. –¢–µ–ø–µ—Ä—å –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –≤ –ª—é–±–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ.

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ Google Apps Script

1. –û—Ç–∫—Ä–æ–π—Ç–µ Google Sheets:
   ```
   https://docs.google.com/spreadsheets/d/1n7E3sph8x_FanomlEuEeG5a0OMWSz9UXNlIjXAr19MU
   ```

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è** ‚Üí **Apps Script**

3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `google_apps_script.js` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–∑ –∫–æ—Ä–Ω—è –ø–∞–ø–∫–∏ `arabica_app`)

4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å –∫–æ–¥** –∏–∑ —Ñ–∞–π–ª–∞ `google_apps_script.js`

5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä Google Apps Script (–∑–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥)

6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+S)

7. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
   - –ù–∞–∂–º–∏—Ç–µ **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å** ‚Üí **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è–º–∏**
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ)
   - –ù–∞–∂–º–∏—Ç–µ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å** (–∫–∞—Ä–∞–Ω–¥–∞—à)
   - –í—ã–±–µ—Ä–∏—Ç–µ **–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è**
   - –ù–∞–∂–º–∏—Ç–µ **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å**

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω–∞ arabica26.ru

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
   ```bash
   ssh user@arabica26.ru
   ```

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞:
   ```bash
   cd /path/to/loyalty-proxy
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥:
   ```bash
   git pull origin main
   ```

   –ò–ª–∏ –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `loyalty-proxy/index.js`:
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ 11 —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL:
   ```javascript
   const SCRIPT_URL = process.env.SCRIPT_URL || "https://script.google.com/macros/s/AKfycbzaH6AqH8j9E93Tf4SFCie35oeESGfBL6p51cTHl9EvKq0Y5bfzg4UbmsDKB1B82yPS/exec";
   ```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä:

   **–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2:**
   ```bash
   pm2 restart loyalty-proxy
   # –∏–ª–∏
   pm2 restart all
   ```

   **–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ systemd:**
   ```bash
   sudo systemctl restart loyalty-proxy
   ```

   **–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –≤—Ä—É—á–Ω—É—é:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C –∏–ª–∏ kill PID)
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
   node index.js
   # –∏–ª–∏
   npm start
   ```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoint:

```powershell
curl "https://arabica26.ru?action=getUserRole&phone=79054443224"
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON:
```json
{
  "success": true,
  "clientName": "–ê–Ω–¥—Ä–µ–π",
  "employeeName": null,
  "isAdmin": 0
}
```

## ‚úÖ –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. Google Apps Script –±—É–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ `getUserRole`
2. –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥
3. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: client/employee/admin
```

–í–º–µ—Å—Ç–æ:
```
! –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª success: false
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Google Apps Script –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å **–Ω–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**
- –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å** –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –≤ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å URL –∏–∑ Google Apps Script




