<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2400">
  <defs>
    <linearGradient id="employeeBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E3F2FD"/>
      <stop offset="100%" style="stop-color:#BBDEFB"/>
    </linearGradient>
    <linearGradient id="adminBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FCE4EC"/>
      <stop offset="100%" style="stop-color:#F8BBD9"/>
    </linearGradient>
    <linearGradient id="serverBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F5E9"/>
      <stop offset="100%" style="stop-color:#C8E6C9"/>
    </linearGradient>
    <linearGradient id="storageBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FFF3E0"/>
      <stop offset="100%" style="stop-color:#FFE0B2"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="2400" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="700" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1A237E">
    Система #8: РКО (Расходный кассовый ордер)
  </text>
  <text x="700" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666">
    Cash Expense Order - Документирование выплат зарплаты сотрудникам
  </text>

  <!-- ==================== VISUAL SCHEMA ==================== -->

  <!-- Employee Section -->
  <rect x="50" y="120" width="400" height="480" rx="15" fill="url(#employeeBg)" filter="url(#shadow)"/>
  <text x="250" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1565C0">
    СОТРУДНИК (Employee)
  </text>

  <!-- Step 1: Type Selection -->
  <rect x="70" y="175" width="360" height="90" rx="10" fill="white" stroke="#1565C0" stroke-width="2"/>
  <text x="250" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">1. Выбор типа РКО</text>
  <text x="250" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">RKOTypeSelectionPage</text>
  <rect x="90" y="240" width="140" height="20" rx="5" fill="#E3F2FD" stroke="#1565C0"/>
  <text x="160" y="254" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565C0">ЗП после смены</text>
  <rect x="240" y="240" width="140" height="20" rx="5" fill="#E3F2FD" stroke="#1565C0"/>
  <text x="310" y="254" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565C0">ЗП за месяц</text>

  <!-- Step 2: Shop Selection -->
  <rect x="70" y="275" width="360" height="80" rx="10" fill="white" stroke="#1565C0" stroke-width="2"/>
  <text x="250" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">2. Выбор магазина</text>
  <text x="250" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Автоматически из последней пересменки</text>
  <text x="250" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">RKOService.getShopFromLastShift()</text>

  <!-- Step 3: Amount Input -->
  <rect x="70" y="365" width="360" height="70" rx="10" fill="white" stroke="#1565C0" stroke-width="2"/>
  <text x="250" y="390" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">3. Ввод суммы</text>
  <text x="250" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">RKOAmountInputPage (₽ TextField)</text>
  <text x="250" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Валидация: число &gt; 0</text>

  <!-- Step 4: PDF Generation -->
  <rect x="70" y="445" width="360" height="70" rx="10" fill="white" stroke="#1565C0" stroke-width="2"/>
  <text x="250" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">4. Генерация PDF</text>
  <text x="250" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">RKOPDFService.generateRKOFromDocx()</text>
  <text x="250" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Fallback: generateRKO() (локально)</text>

  <!-- Step 5: Upload -->
  <rect x="70" y="525" width="360" height="60" rx="10" fill="white" stroke="#1565C0" stroke-width="2"/>
  <text x="250" y="550" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">5. Загрузка на сервер</text>
  <text x="250" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">RKOReportsService.uploadRKO()</text>

  <!-- Arrow from Employee to Server -->
  <path d="M 430 450 L 530 450" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <text x="480" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">POST</text>

  <!-- Server Section -->
  <rect x="550" y="120" width="380" height="480" rx="15" fill="url(#serverBg)" filter="url(#shadow)"/>
  <text x="740" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2E7D32">
    СЕРВЕР (Server)
  </text>

  <!-- API Endpoints -->
  <rect x="570" y="175" width="340" height="200" rx="10" fill="white" stroke="#2E7D32" stroke-width="2"/>
  <text x="740" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">API Endpoints</text>

  <text x="590" y="225" font-family="monospace" font-size="10" fill="#333">POST /api/rko/generate-from-docx</text>
  <text x="590" y="245" font-family="monospace" font-size="9" fill="#666">  → Генерация PDF из .docx шаблона</text>

  <text x="590" y="270" font-family="monospace" font-size="10" fill="#333">POST /api/rko/upload</text>
  <text x="590" y="290" font-family="monospace" font-size="9" fill="#666">  → Multipart: docx файл + метаданные</text>

  <text x="590" y="315" font-family="monospace" font-size="10" fill="#333">GET /api/rko/list/employee/:name</text>
  <text x="590" y="335" font-family="monospace" font-size="9" fill="#666">  → Список РКО сотрудника</text>

  <text x="590" y="360" font-family="monospace" font-size="10" fill="#333">GET /api/rko/list/shop/:address</text>
  <text x="590" y="380" font-family="monospace" font-size="9" fill="#666">  → Список РКО магазина</text>

  <!-- Shop Settings -->
  <rect x="570" y="385" width="340" height="100" rx="10" fill="white" stroke="#2E7D32" stroke-width="2"/>
  <text x="740" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">Shop Settings API</text>

  <text x="590" y="435" font-family="monospace" font-size="10" fill="#333">GET /api/shop-settings/:address</text>
  <text x="590" y="455" font-family="monospace" font-size="9" fill="#666">  → ИНН, директор, адрес</text>

  <text x="590" y="475" font-family="monospace" font-size="10" fill="#333">POST .../document-number</text>
  <text x="590" y="495" font-family="monospace" font-size="9" fill="#666">  → Следующий номер документа</text>

  <!-- PDF Generation Details -->
  <rect x="570" y="495" width="340" height="90" rx="10" fill="white" stroke="#2E7D32" stroke-width="2"/>
  <text x="740" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">PDF Generation</text>
  <text x="590" y="545" font-family="Arial, sans-serif" font-size="11" fill="#333">• Шаблон: Унифицированная форма КО-2</text>
  <text x="590" y="565" font-family="Arial, sans-serif" font-size="11" fill="#333">• Шрифт: LiberationSerif-Regular.ttf</text>
  <text x="590" y="580" font-family="Arial, sans-serif" font-size="11" fill="#333">• Сумма прописью: numberToWords()</text>

  <!-- Admin Section -->
  <rect x="950" y="120" width="400" height="480" rx="15" fill="url(#adminBg)" filter="url(#shadow)"/>
  <text x="1150" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#C2185B">
    АДМИН (Admin)
  </text>

  <!-- Reports Page -->
  <rect x="970" y="175" width="360" height="90" rx="10" fill="white" stroke="#C2185B" stroke-width="2"/>
  <text x="1150" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#C2185B">RKOReportsPage</text>
  <text x="1150" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Выбор типа отчёта</text>
  <rect x="990" y="235" width="140" height="25" rx="5" fill="#FCE4EC" stroke="#C2185B"/>
  <text x="1060" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#C2185B">По сотруднику</text>
  <rect x="1140" y="235" width="140" height="25" rx="5" fill="#FCE4EC" stroke="#C2185B"/>
  <text x="1210" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#C2185B">По магазину</text>

  <!-- Employee Reports -->
  <rect x="970" y="275" width="360" height="100" rx="10" fill="white" stroke="#C2185B" stroke-width="2"/>
  <text x="1150" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#C2185B">RKOEmployeeReportsPage</text>
  <text x="990" y="325" font-family="Arial, sans-serif" font-size="11" fill="#333">• Выбор сотрудника из списка</text>
  <text x="990" y="345" font-family="Arial, sans-serif" font-size="11" fill="#333">• Фильтрация по месяцам (YYYY-MM)</text>
  <text x="990" y="365" font-family="Arial, sans-serif" font-size="11" fill="#333">• Список РКО с суммами и типами</text>

  <!-- Shop Reports -->
  <rect x="970" y="385" width="360" height="100" rx="10" fill="white" stroke="#C2185B" stroke-width="2"/>
  <text x="1150" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#C2185B">RKOShopReportsPage</text>
  <text x="990" y="435" font-family="Arial, sans-serif" font-size="11" fill="#333">• Выбор магазина из списка</text>
  <text x="990" y="455" font-family="Arial, sans-serif" font-size="11" fill="#333">• Фильтрация по месяцам</text>
  <text x="990" y="475" font-family="Arial, sans-serif" font-size="11" fill="#333">• Все РКО выбранного магазина</text>

  <!-- PDF Viewer -->
  <rect x="970" y="495" width="360" height="90" rx="10" fill="white" stroke="#C2185B" stroke-width="2"/>
  <text x="1150" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#C2185B">RKOPDFViewerPage</text>
  <text x="990" y="545" font-family="Arial, sans-serif" font-size="11" fill="#333">• Просмотр PDF через WebView</text>
  <text x="990" y="565" font-family="Arial, sans-serif" font-size="11" fill="#333">• URL: /api/rko/file/:fileName</text>
  <text x="990" y="580" font-family="Arial, sans-serif" font-size="11" fill="#333">• Скачивание документа</text>

  <!-- Arrow Server to Admin -->
  <path d="M 930 350 L 970 350" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>

  <!-- Storage Section -->
  <rect x="50" y="620" width="1300" height="180" rx="15" fill="url(#storageBg)" filter="url(#shadow)"/>
  <text x="700" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#E65100">
    ХРАНЕНИЕ ДАННЫХ (Storage)
  </text>

  <!-- Server Storage -->
  <rect x="70" y="675" width="600" height="110" rx="10" fill="white" stroke="#E65100" stroke-width="2"/>
  <text x="370" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#E65100">Серверное хранилище</text>
  <text x="90" y="725" font-family="monospace" font-size="11" fill="#333">/root/arabica_app/data/rko/</text>
  <text x="90" y="745" font-family="monospace" font-size="10" fill="#666">  ├── DD_MM_YYYY_ShopAddress_Employee.pdf</text>
  <text x="90" y="765" font-family="monospace" font-size="10" fill="#666">  └── metadata.json (список всех РКО)</text>
  <text x="400" y="725" font-family="Arial, sans-serif" font-size="11" fill="#333">Шаблон:</text>
  <text x="400" y="745" font-family="monospace" font-size="10" fill="#666">/templates/rko_template.docx</text>

  <!-- Local Storage -->
  <rect x="690" y="675" width="640" height="110" rx="10" fill="white" stroke="#E65100" stroke-width="2"/>
  <text x="1010" y="700" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#E65100">Локальное хранилище (Fallback)</text>
  <text x="710" y="725" font-family="Arial, sans-serif" font-size="11" fill="#333">• getExternalStorageDirectory()/Download/</text>
  <text x="710" y="745" font-family="Arial, sans-serif" font-size="11" fill="#333">• getApplicationDocumentsDirectory()/RKOs/</text>
  <text x="710" y="765" font-family="Arial, sans-serif" font-size="11" fill="#666">Используется только если сервер недоступен</text>

  <!-- ==================== DETAILED DESCRIPTION ==================== -->

  <rect x="50" y="820" width="1300" height="1550" rx="15" fill="white" stroke="#1A237E" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="855" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1A237E">
    ДЕТАЛЬНОЕ ОПИСАНИЕ СИСТЕМЫ РКО
  </text>

  <!-- RKOMetadata Model -->
  <rect x="70" y="880" width="600" height="220" rx="10" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
  <text x="370" y="905" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7B1FA2">
    RKOMetadata (Модель метаданных)
  </text>
  <text x="90" y="930" font-family="monospace" font-size="11" fill="#333">class RKOMetadata {</text>
  <text x="100" y="950" font-family="monospace" font-size="11" fill="#333">  String fileName;      // DD_MM_YYYY_Shop_Name.pdf</text>
  <text x="100" y="970" font-family="monospace" font-size="11" fill="#333">  String employeeName;  // Имя сотрудника (lowercase)</text>
  <text x="100" y="990" font-family="monospace" font-size="11" fill="#333">  String shopAddress;   // Адрес магазина</text>
  <text x="100" y="1010" font-family="monospace" font-size="11" fill="#333">  DateTime date;        // Дата создания РКО</text>
  <text x="100" y="1030" font-family="monospace" font-size="11" fill="#333">  double amount;        // Сумма в рублях</text>
  <text x="100" y="1050" font-family="monospace" font-size="11" fill="#333">  String rkoType;       // "ЗП после смены" | "ЗП за месяц"</text>
  <text x="100" y="1070" font-family="monospace" font-size="11" fill="#333">  DateTime createdAt;   // Время создания записи</text>
  <text x="90" y="1090" font-family="monospace" font-size="11" fill="#333">}</text>

  <!-- RKOMetadataList Methods -->
  <rect x="690" y="880" width="640" height="220" rx="10" fill="#E8EAF6" stroke="#3F51B5" stroke-width="2"/>
  <text x="1010" y="905" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#3F51B5">
    RKOMetadataList (Методы работы со списком)
  </text>
  <text x="710" y="935" font-family="monospace" font-size="11" fill="#333">getLatestForEmployee(name, count)</text>
  <text x="720" y="955" font-family="Arial, sans-serif" font-size="10" fill="#666">→ Последние N РКО сотрудника</text>

  <text x="710" y="980" font-family="monospace" font-size="11" fill="#333">getForEmployeeByMonth(name, monthKey)</text>
  <text x="720" y="1000" font-family="Arial, sans-serif" font-size="10" fill="#666">→ РКО сотрудника за месяц (YYYY-MM)</text>

  <text x="710" y="1025" font-family="monospace" font-size="11" fill="#333">getForShopByMonth(address, monthKey)</text>
  <text x="720" y="1045" font-family="Arial, sans-serif" font-size="10" fill="#666">→ РКО магазина за месяц</text>

  <text x="710" y="1070" font-family="monospace" font-size="11" fill="#333">getUniqueEmployees() / getUniqueShops()</text>
  <text x="720" y="1090" font-family="Arial, sans-serif" font-size="10" fill="#666">→ Списки для фильтров</text>

  <!-- PDF Generation Details -->
  <rect x="70" y="1115" width="1260" height="250" rx="10" fill="#E0F2F1" stroke="#00695C" stroke-width="2"/>
  <text x="700" y="1140" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#00695C">
    Генерация PDF (RKOPDFService)
  </text>

  <text x="90" y="1170" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#00695C">Формат документа:</text>
  <text x="100" y="1190" font-family="Arial, sans-serif" font-size="11" fill="#333">• Унифицированная форма № КО-2 (Госкомстат России от 18.08.98 № 88)</text>
  <text x="100" y="1210" font-family="Arial, sans-serif" font-size="11" fill="#333">• Формат: A4 portrait</text>
  <text x="100" y="1230" font-family="Arial, sans-serif" font-size="11" fill="#333">• Шрифт: LiberationSerif-Regular.ttf (поддержка кириллицы)</text>

  <text x="90" y="1260" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#00695C">Данные в документе:</text>
  <text x="100" y="1280" font-family="Arial, sans-serif" font-size="11" fill="#333">• Организация: ИП + ФИО директора + ИНН из ShopSettings</text>
  <text x="100" y="1300" font-family="Arial, sans-serif" font-size="11" fill="#333">• Номер документа: автоинкремент (GET/POST .../document-number)</text>
  <text x="100" y="1320" font-family="Arial, sans-serif" font-size="11" fill="#333">• Сумма прописью: numberToWords() с склонением рублей и тысяч</text>
  <text x="100" y="1340" font-family="Arial, sans-serif" font-size="11" fill="#333">• Паспортные данные: серия, номер, кем выдан, дата выдачи (из EmployeeRegistration)</text>
  <text x="100" y="1360" font-family="Arial, sans-serif" font-size="11" fill="#333">• Подпись получателя: место для подписи сотрудника</text>

  <!-- File Naming Convention -->
  <rect x="70" y="1380" width="600" height="130" rx="10" fill="#FFF8E1" stroke="#FF8F00" stroke-width="2"/>
  <text x="370" y="1405" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#FF8F00">
    Формат имени файла
  </text>
  <text x="90" y="1435" font-family="monospace" font-size="12" fill="#333">DD_MM_YYYY_ShopAddress_EmployeeLastName.pdf</text>
  <text x="90" y="1460" font-family="Arial, sans-serif" font-size="11" fill="#666">Пример: 14_01_2026_Lenina_12_Ivanov.pdf</text>
  <text x="90" y="1485" font-family="Arial, sans-serif" font-size="11" fill="#666">Спецсимволы (, . / ( )) заменяются на _</text>
  <text x="90" y="1505" font-family="Arial, sans-serif" font-size="11" fill="#666">Фамилия берётся из ФИО (первое слово)</text>

  <!-- RKO Types -->
  <rect x="690" y="1380" width="640" height="130" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
  <text x="1010" y="1405" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1976D2">
    Типы РКО (rkoType)
  </text>

  <rect x="710" y="1425" width="280" height="35" rx="8" fill="#BBDEFB"/>
  <text x="850" y="1448" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">ЗП после смены</text>
  <text x="1000" y="1448" font-family="Arial, sans-serif" font-size="11" fill="#666">Выплата после работы</text>

  <rect x="710" y="1470" width="280" height="35" rx="8" fill="#BBDEFB"/>
  <text x="850" y="1493" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">ЗП за месяц</text>
  <text x="1000" y="1493" font-family="Arial, sans-serif" font-size="11" fill="#666">Месячная выплата</text>

  <!-- Flutter Files -->
  <rect x="70" y="1525" width="600" height="320" rx="10" fill="#E8F5E9" stroke="#388E3C" stroke-width="2"/>
  <text x="370" y="1550" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#388E3C">
    Flutter файлы
  </text>

  <text x="90" y="1580" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388E3C">Pages:</text>
  <text x="100" y="1600" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_type_selection_page.dart</text>
  <text x="100" y="1620" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_amount_input_page.dart</text>
  <text x="100" y="1640" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_pdf_viewer_page.dart</text>
  <text x="100" y="1660" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_reports_page.dart</text>
  <text x="100" y="1680" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_employee_reports_page.dart</text>
  <text x="100" y="1700" font-family="monospace" font-size="10" fill="#333">lib/features/rko/pages/rko_shop_reports_page.dart</text>

  <text x="90" y="1730" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388E3C">Services:</text>
  <text x="100" y="1750" font-family="monospace" font-size="10" fill="#333">lib/features/rko/services/rko_service.dart</text>
  <text x="100" y="1770" font-family="monospace" font-size="10" fill="#333">lib/features/rko/services/rko_pdf_service.dart</text>
  <text x="100" y="1790" font-family="monospace" font-size="10" fill="#333">lib/features/rko/services/rko_reports_service.dart</text>

  <text x="90" y="1820" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388E3C">Models:</text>
  <text x="100" y="1840" font-family="monospace" font-size="10" fill="#333">lib/features/rko/models/rko_report_model.dart</text>

  <!-- Server Files -->
  <rect x="690" y="1525" width="640" height="320" rx="10" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2"/>
  <text x="1010" y="1550" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#D32F2F">
    Серверные файлы и данные
  </text>

  <text x="710" y="1580" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#D32F2F">API (loyalty-proxy/index.js):</text>
  <text x="720" y="1600" font-family="monospace" font-size="10" fill="#333">POST /api/rko/generate-from-docx</text>
  <text x="720" y="1620" font-family="monospace" font-size="10" fill="#333">POST /api/rko/upload (multipart)</text>
  <text x="720" y="1640" font-family="monospace" font-size="10" fill="#333">GET  /api/rko/list/employee/:name</text>
  <text x="720" y="1660" font-family="monospace" font-size="10" fill="#333">GET  /api/rko/list/shop/:address</text>
  <text x="720" y="1680" font-family="monospace" font-size="10" fill="#333">GET  /api/rko/file/:fileName</text>

  <text x="710" y="1710" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#D32F2F">Хранилище:</text>
  <text x="720" y="1730" font-family="monospace" font-size="10" fill="#333">/root/arabica_app/data/rko/*.pdf</text>
  <text x="720" y="1750" font-family="monospace" font-size="10" fill="#333">/root/arabica_app/data/rko/metadata.json</text>
  <text x="720" y="1770" font-family="monospace" font-size="10" fill="#333">/root/arabica_app/templates/rko_template.docx</text>

  <text x="710" y="1800" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#D32F2F">Настройки магазинов:</text>
  <text x="720" y="1820" font-family="monospace" font-size="10" fill="#333">/root/arabica_app/data/shop-settings/:address.json</text>
  <text x="720" y="1840" font-family="Arial, sans-serif" font-size="10" fill="#666">  → inn, directorName, address, documentNumber</text>

  <!-- Important Notes -->
  <rect x="70" y="1860" width="1260" height="200" rx="10" fill="#FFF3E0" stroke="#E65100" stroke-width="2"/>
  <text x="700" y="1885" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#E65100">
    ВАЖНЫЕ ОСОБЕННОСТИ
  </text>

  <text x="90" y="1915" font-family="Arial, sans-serif" font-size="12" fill="#333">1. Автоопределение магазина: берётся из последней пересменки сотрудника (RKOService.getShopFromLastShift)</text>
  <text x="90" y="1940" font-family="Arial, sans-serif" font-size="12" fill="#333">2. Имя сотрудника: используется единый источник истины - EmployeesPage.getCurrentEmployeeName()</text>
  <text x="90" y="1965" font-family="Arial, sans-serif" font-size="12" fill="#333">3. Нормализация имени: lowercase + trim + replaceAll(r'\s+', ' ') для поиска в отчётах</text>
  <text x="90" y="1990" font-family="Arial, sans-serif" font-size="12" fill="#333">4. Fallback генерации: если сервер не поддерживает .docx шаблон → локальная генерация через pdf/widgets</text>
  <text x="90" y="2015" font-family="Arial, sans-serif" font-size="12" fill="#333">5. Очистка кэша KPI: после создания РКО очищается кэш для немедленного отображения в отчётах</text>
  <text x="90" y="2040" font-family="Arial, sans-serif" font-size="12" fill="#333">6. Паспортные данные: берутся из EmployeeRegistration (passportSeries, passportNumber, issuedBy, issueDate)</text>

  <!-- Flow Diagram -->
  <rect x="70" y="2075" width="1260" height="270" rx="10" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2"/>
  <text x="700" y="2100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7B1FA2">
    ПОСЛЕДОВАТЕЛЬНОСТЬ СОЗДАНИЯ РКО
  </text>

  <!-- Flow boxes -->
  <rect x="90" y="2120" width="150" height="50" rx="8" fill="#E1BEE7"/>
  <text x="165" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">1. Выбор типа</text>

  <path d="M 240 2145 L 280 2145" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="280" y="2120" width="150" height="50" rx="8" fill="#E1BEE7"/>
  <text x="355" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">2. Выбор магазина</text>

  <path d="M 430 2145 L 470 2145" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="470" y="2120" width="150" height="50" rx="8" fill="#E1BEE7"/>
  <text x="545" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">3. Ввод суммы</text>

  <path d="M 620 2145 L 660 2145" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="660" y="2120" width="170" height="50" rx="8" fill="#E1BEE7"/>
  <text x="745" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">4. ShopSettings</text>

  <path d="M 830 2145 L 870 2145" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="870" y="2120" width="170" height="50" rx="8" fill="#E1BEE7"/>
  <text x="955" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">5. EmployeeData</text>

  <path d="M 1040 2145 L 1080 2145" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="1080" y="2120" width="170" height="50" rx="8" fill="#E1BEE7"/>
  <text x="1165" y="2150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7B1FA2">6. Doc Number</text>

  <!-- Second row -->
  <path d="M 1165 2170 L 1165 2200" stroke="#7B1FA2" stroke-width="2"/>
  <path d="M 1165 2200 L 545 2200" stroke="#7B1FA2" stroke-width="2"/>
  <path d="M 545 2200 L 545 2220" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="470" y="2220" width="150" height="50" rx="8" fill="#C8E6C9"/>
  <text x="545" y="2250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2E7D32">7. Generate PDF</text>

  <path d="M 620 2245 L 660 2245" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="660" y="2220" width="170" height="50" rx="8" fill="#C8E6C9"/>
  <text x="745" y="2250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2E7D32">8. Upload Server</text>

  <path d="M 830 2245 L 870 2245" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="870" y="2220" width="170" height="50" rx="8" fill="#C8E6C9"/>
  <text x="955" y="2250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2E7D32">9. Update DocNum</text>

  <path d="M 1040 2245 L 1080 2245" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrowhead)"/>

  <rect x="1080" y="2220" width="170" height="50" rx="8" fill="#C8E6C9"/>
  <text x="1165" y="2250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2E7D32">10. Clear KPI Cache</text>

  <!-- Details for each step -->
  <text x="90" y="2300" font-family="Arial, sans-serif" font-size="10" fill="#666">
    4: RKOService.getShopSettings() | 5: RKOService.getEmployeeData() | 6: RKOService.getNextDocumentNumber()
  </text>
  <text x="90" y="2320" font-family="Arial, sans-serif" font-size="10" fill="#666">
    7: RKOPDFService.generateRKOFromDocx() | 8: RKOReportsService.uploadRKO() | 9: RKOService.updateDocumentNumber()
  </text>
  <text x="90" y="2340" font-family="Arial, sans-serif" font-size="10" fill="#666">
    10: KPIService.clearCacheForDate() + clearCacheForShop() → РКО сразу отображается в отчётах
  </text>

</svg>
