<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1050">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="employeeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3"/>
      <stop offset="100%" style="stop-color:#1565C0"/>
    </linearGradient>
    <linearGradient id="geoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#2E7D32"/>
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0"/>
      <stop offset="100%" style="stop-color:#6A1B9A"/>
    </linearGradient>
    <linearGradient id="onTimeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#2E7D32"/>
    </linearGradient>
    <linearGradient id="lateGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800"/>
      <stop offset="100%" style="stop-color:#EF6C00"/>
    </linearGradient>
    <linearGradient id="outOfShiftGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FFC107"/>
      <stop offset="100%" style="stop-color:#FFA000"/>
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1050" fill="#f5f5f5"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#333">
    СИСТЕМА "Я НА РАБОТЕ" (ATTENDANCE)
  </text>
  <text x="700" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">
    Arabica App - Блок B, Система #4 | Геолокация + отметка прихода
  </text>

  <!-- ============ VISUAL FLOW SECTION ============ -->
  <rect x="20" y="85" width="860" height="480" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="450" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ВИЗУАЛЬНАЯ СХЕМА
  </text>

  <!-- Employee Block -->
  <rect x="50" y="130" width="160" height="80" rx="10" fill="url(#employeeGrad)" filter="url(#shadow)"/>
  <text x="130" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">СОТРУДНИК</text>
  <text x="130" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Панель работника</text>

  <!-- Arrow to Page -->
  <path d="M210 170 L270 170" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Attendance Page -->
  <rect x="280" y="130" width="220" height="100" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
  <text x="390" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">
    AttendanceShopSelectionPage
  </text>
  <text x="295" y="180" font-family="Arial" font-size="10" fill="#333">1. Список магазинов</text>
  <text x="295" y="198" font-family="Arial" font-size="10" fill="#333">2. Нажать на галочку</text>
  <text x="295" y="216" font-family="Arial" font-size="10" fill="#333">3. Запрос геолокации</text>

  <!-- Arrow to Geo Check -->
  <path d="M500 175 L560 175" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Geolocation Check -->
  <rect x="570" y="130" width="180" height="100" rx="10" fill="url(#geoGrad)" filter="url(#shadow)"/>
  <text x="660" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">ПРОВЕРКА GEO</text>
  <text x="585" y="180" font-family="Arial" font-size="10" fill="white">Geolocator.getCurrentPosition</text>
  <text x="585" y="198" font-family="Arial" font-size="10" fill="white">calculateDistance()</text>
  <text x="585" y="216" font-family="Arial" font-size="10" fill="white">Радиус: 750 метров</text>

  <!-- Decision Diamond -->
  <polygon points="770,175 820,135 870,175 820,215" fill="#FFC107" stroke="#F57F17" stroke-width="2"/>
  <text x="820" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#333">В радиусе</text>
  <text x="820" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">750м?</text>

  <!-- Arrow to decision -->
  <path d="M750 175 L765 175" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- NO branch -->
  <path d="M820 215 L820 280" stroke="#E53935" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="835" y="250" font-family="Arial" font-size="10" fill="#E53935">НЕТ</text>

  <rect x="730" y="290" width="180" height="60" rx="8" fill="#FFEBEE" stroke="#E53935"/>
  <text x="820" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#C62828">ОШИБКА</text>
  <text x="820" y="335" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">"Вы слишком далеко"</text>

  <!-- YES branch - to Server -->
  <path d="M820 135 L820 80 L660 80 L660 390" stroke="#4CAF50" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="750" y="70" font-family="Arial" font-size="10" fill="#4CAF50">ДА</text>

  <!-- Server Block -->
  <rect x="50" y="370" width="320" height="180" rx="10" fill="url(#serverGrad)" filter="url(#shadow)"/>
  <text x="210" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    СЕРВЕР (arabica26.ru)
  </text>
  <text x="65" y="420" font-family="monospace" font-size="10" fill="white">POST /api/attendance</text>
  <text x="65" y="445" font-family="Arial" font-size="10" fill="white">Получает: employeeName, shopAddress,</text>
  <text x="65" y="460" font-family="Arial" font-size="10" fill="white">latitude, longitude, distance, timestamp</text>

  <text x="65" y="490" font-family="Arial" font-size="10" fill="#FFC107" font-weight="bold">Логика определения смены:</text>
  <text x="65" y="508" font-family="Arial" font-size="9" fill="white">- Утро:  08:00-08:30 (morning)</text>
  <text x="65" y="523" font-family="Arial" font-size="9" fill="white">- День:  14:00-14:30 (day)</text>
  <text x="65" y="538" font-family="Arial" font-size="9" fill="white">- Ночь:  20:00-20:30 (night)</text>

  <!-- Arrow to Results -->
  <path d="M370 455 L430 455" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Results Block -->
  <rect x="440" y="370" width="420" height="180" rx="10" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="650" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">
    РЕЗУЛЬТАТЫ ОТМЕТКИ
  </text>

  <!-- On Time -->
  <rect x="460" y="415" width="120" height="60" rx="8" fill="url(#onTimeGrad)" filter="url(#shadow)"/>
  <text x="520" y="440" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">ВОВРЕМЯ</text>
  <text x="520" y="458" text-anchor="middle" font-family="Arial" font-size="9" fill="white">isOnTime=true</text>
  <text x="520" y="473" text-anchor="middle" font-family="Arial" font-size="9" fill="white">+баллы</text>

  <!-- Late -->
  <rect x="590" y="415" width="120" height="60" rx="8" fill="url(#lateGrad)" filter="url(#shadow)"/>
  <text x="650" y="440" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">ОПОЗДАНИЕ</text>
  <text x="650" y="458" text-anchor="middle" font-family="Arial" font-size="9" fill="white">isOnTime=false</text>
  <text x="650" y="473" text-anchor="middle" font-family="Arial" font-size="9" fill="white">lateMinutes=N</text>

  <!-- Out of shift -->
  <rect x="720" y="415" width="120" height="60" rx="8" fill="url(#outOfShiftGrad)" filter="url(#shadow)"/>
  <text x="780" y="440" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">ВНЕ СМЕНЫ</text>
  <text x="780" y="458" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">isOnTime=null</text>
  <text x="780" y="473" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">shiftType=null</text>

  <!-- Efficiency points info -->
  <text x="460" y="510" font-family="Arial" font-size="10" fill="#2E7D32" font-weight="bold">Влияние на эффективность:</text>
  <text x="460" y="528" font-family="Arial" font-size="9" fill="#333">+ баллы за приход вовремя (настраиваемо админом)</text>
  <text x="460" y="543" font-family="Arial" font-size="9" fill="#333">- штраф за опоздание (настраиваемо админом)</text>

  <!-- ============ DESCRIPTION SECTION ============ -->
  <rect x="900" y="85" width="480" height="480" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="1140" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ОПИСАНИЕ СИСТЕМЫ
  </text>

  <!-- Files Section -->
  <rect x="920" y="125" width="440" height="120" rx="5" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="1140" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">ФАЙЛЫ FLUTTER</text>

  <text x="940" y="170" font-family="monospace" font-size="9" fill="#333">lib/features/attendance/pages/</text>
  <text x="955" y="185" font-family="monospace" font-size="9" fill="#1565C0">attendance_shop_selection_page.dart</text>
  <text x="1240" y="185" font-family="Arial" font-size="8" fill="#666">← UI</text>

  <text x="940" y="205" font-family="monospace" font-size="9" fill="#333">lib/features/attendance/services/</text>
  <text x="955" y="220" font-family="monospace" font-size="9" fill="#1565C0">attendance_service.dart</text>
  <text x="1200" y="220" font-family="Arial" font-size="8" fill="#666">← Логика, GEO</text>

  <text x="940" y="240" font-family="monospace" font-size="9" fill="#333">lib/features/attendance/models/</text>
  <text x="955" y="255" font-family="monospace" font-size="9" fill="#1565C0">attendance_model.dart</text>
  <text x="1200" y="255" font-family="Arial" font-size="8" fill="#666">← Модель</text>

  <!-- API Section -->
  <rect x="920" y="255" width="440" height="100" rx="5" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1140" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2E7D32">API ЭНДПОИНТЫ</text>

  <text x="940" y="300" font-family="monospace" font-size="10" fill="#333">POST /api/attendance</text>
  <text x="1200" y="300" font-family="Arial" font-size="9" fill="#666">Создать отметку</text>
  <text x="940" y="318" font-family="monospace" font-size="10" fill="#333">GET  /api/attendance</text>
  <text x="1200" y="318" font-family="Arial" font-size="9" fill="#666">Список (админ)</text>
  <text x="940" y="336" font-family="monospace" font-size="10" fill="#333">GET  /api/attendance/check</text>
  <text x="1200" y="336" font-family="Arial" font-size="9" fill="#666">Проверка сегодня</text>

  <!-- Model Section -->
  <rect x="920" y="365" width="440" height="190" rx="5" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="1140" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7B1FA2">AttendanceRecord Model</text>

  <text x="940" y="410" font-family="monospace" font-size="9" fill="#333">id: String           - attendance_{name}_{date}</text>
  <text x="940" y="427" font-family="monospace" font-size="9" fill="#333">employeeName: String - Имя сотрудника</text>
  <text x="940" y="444" font-family="monospace" font-size="9" fill="#333">shopAddress: String  - Адрес магазина</text>
  <text x="940" y="461" font-family="monospace" font-size="9" fill="#333">timestamp: DateTime  - Время отметки</text>
  <text x="940" y="478" font-family="monospace" font-size="9" fill="#333">latitude: double     - Широта</text>
  <text x="940" y="495" font-family="monospace" font-size="9" fill="#333">longitude: double    - Долгота</text>
  <text x="940" y="512" font-family="monospace" font-size="9" fill="#333">distance: double?    - Расстояние до магазина (м)</text>
  <text x="940" y="529" font-family="monospace" font-size="9" fill="#333">isOnTime: bool?      - Вовремя (true/false/null)</text>
  <text x="940" y="546" font-family="monospace" font-size="9" fill="#333">shiftType: String?   - morning/day/night/null</text>
  <text x="940" y="563" font-family="monospace" font-size="9" fill="#333">lateMinutes: int?    - Минут опоздания</text>

  <!-- ============ SHIFT SCHEDULE ============ -->
  <rect x="20" y="580" width="660" height="150" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="350" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    РАСПИСАНИЕ СМЕН (определяется сервером)
  </text>

  <!-- Morning -->
  <rect x="40" y="625" width="190" height="90" rx="8" fill="#FFECB3" stroke="#FFC107"/>
  <text x="135" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#F57F17">УТРО (morning)</text>
  <text x="135" y="675" text-anchor="middle" font-family="Arial" font-size="11" fill="#333">Интервал: 08:00 - 08:30</text>
  <text x="135" y="695" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">Вовремя до 08:30</text>
  <text x="135" y="710" text-anchor="middle" font-family="Arial" font-size="10" fill="#FF5722">После 08:30 = опоздание</text>

  <!-- Day -->
  <rect x="250" y="625" width="190" height="90" rx="8" fill="#FFE0B2" stroke="#FF9800"/>
  <text x="345" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#E65100">ДЕНЬ (day)</text>
  <text x="345" y="675" text-anchor="middle" font-family="Arial" font-size="11" fill="#333">Интервал: 14:00 - 14:30</text>
  <text x="345" y="695" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">Вовремя до 14:30</text>
  <text x="345" y="710" text-anchor="middle" font-family="Arial" font-size="10" fill="#FF5722">После 14:30 = опоздание</text>

  <!-- Night -->
  <rect x="460" y="625" width="190" height="90" rx="8" fill="#E8EAF6" stroke="#3F51B5"/>
  <text x="555" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#303F9F">НОЧЬ (night)</text>
  <text x="555" y="675" text-anchor="middle" font-family="Arial" font-size="11" fill="#333">Интервал: 20:00 - 20:30</text>
  <text x="555" y="695" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">Вовремя до 20:30</text>
  <text x="555" y="710" text-anchor="middle" font-family="Arial" font-size="10" fill="#FF5722">После 20:30 = опоздание</text>

  <!-- Geolocation Details -->
  <rect x="700" y="580" width="680" height="150" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="1040" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    ГЕОЛОКАЦИЯ
  </text>

  <text x="720" y="635" font-family="Arial" font-size="11" fill="#333" font-weight="bold">Пакет: geolocator (Flutter)</text>
  <text x="720" y="658" font-family="Arial" font-size="10" fill="#333">1. Проверка: serviceEnabled, permission</text>
  <text x="720" y="678" font-family="Arial" font-size="10" fill="#333">2. getCurrentPosition(desiredAccuracy: high)</text>
  <text x="720" y="698" font-family="Arial" font-size="10" fill="#333">3. distanceBetween(user, shop) - формула Haversine</text>
  <text x="720" y="718" font-family="Arial" font-size="10" fill="#333">4. Радиус проверки: 750 метров (AppConstants.checkInRadius)</text>

  <rect x="1050" y="625" width="300" height="90" rx="8" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1200" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#2E7D32">КООРДИНАТЫ МАГАЗИНОВ</text>
  <text x="1070" y="675" font-family="Arial" font-size="10" fill="#333">Хранятся в Shop модели</text>
  <text x="1070" y="693" font-family="Arial" font-size="10" fill="#333">Загружаются из Google Sheets</text>
  <text x="1070" y="711" font-family="Arial" font-size="10" fill="#333">shop.latitude, shop.longitude</text>

  <!-- Storage Section -->
  <rect x="20" y="745" width="1360" height="80" rx="10" fill="#E0E0E0"/>
  <text x="700" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    ХРАНЕНИЕ ДАННЫХ
  </text>
  <text x="700" y="800" text-anchor="middle" font-family="monospace" font-size="12" fill="#333">
    Сервер: /root/arabica_app/data/attendance.json
  </text>
  <text x="700" y="820" text-anchor="middle" font-family="Arial" font-size="11" fill="#666">
    Одна запись в день на сотрудника | ID = attendance_{employeeName}_{YYYY-MM-DD}
  </text>

  <!-- Important Notes -->
  <rect x="20" y="840" width="1360" height="100" rx="10" fill="#FFFDE7" stroke="#FBC02D" filter="url(#shadow)"/>
  <text x="700" y="865" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#F57F17">
    ВАЖНЫЕ ЗАМЕЧАНИЯ
  </text>
  <text x="40" y="890" font-family="Arial" font-size="11" fill="#333">
    1. Сотрудник может отметиться только ОДИН раз в день (проверка hasAttendanceToday)
  </text>
  <text x="40" y="910" font-family="Arial" font-size="11" fill="#333">
    2. Геолокация обязательна - без разрешения отметка невозможна
  </text>
  <text x="40" y="930" font-family="Arial" font-size="11" fill="#333">
    3. Баллы за приход/штраф за опоздание настраиваются в "Установка баллов" (админ)
  </text>

  <!-- Version info -->
  <rect x="20" y="955" width="1360" height="50" rx="10" fill="#E0E0E0"/>
  <text x="700" y="985" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Arabica App v1.6.1 | Документация: Блок B - Система #4 | Создано: 2026-01-13
  </text>
</svg>
