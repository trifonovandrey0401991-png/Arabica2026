<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1050">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="employeeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3"/>
      <stop offset="100%" style="stop-color:#1565C0"/>
    </linearGradient>
    <linearGradient id="managerGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0"/>
      <stop offset="100%" style="stop-color:#6A1B9A"/>
    </linearGradient>
    <linearGradient id="adminGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F44336"/>
      <stop offset="100%" style="stop-color:#C62828"/>
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#607D8B"/>
      <stop offset="100%" style="stop-color:#455A64"/>
    </linearGradient>
    <linearGradient id="pendingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800"/>
      <stop offset="100%" style="stop-color:#EF6C00"/>
    </linearGradient>
    <linearGradient id="confirmedGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#2E7D32"/>
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1050" fill="#f5f5f5"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#333">
    СИСТЕМА "СДАТЬ СМЕНУ" (SHIFT HANDOVER)
  </text>
  <text x="700" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">
    Arabica App - Блок B, Система #6 | Вопросы при уходе со смены
  </text>

  <!-- ============ VISUAL FLOW SECTION ============ -->
  <rect x="20" y="85" width="860" height="480" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="450" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ВИЗУАЛЬНАЯ СХЕМА
  </text>

  <!-- Employee Flow -->
  <rect x="50" y="140" width="140" height="60" rx="10" fill="url(#employeeGrad)" filter="url(#shadow)"/>
  <text x="120" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">СОТРУДНИК</text>
  <text x="120" y="185" text-anchor="middle" font-family="Arial" font-size="9" fill="white">targetRole: employee</text>

  <!-- Manager Flow -->
  <rect x="50" y="220" width="140" height="60" rx="10" fill="url(#managerGrad)" filter="url(#shadow)"/>
  <text x="120" y="248" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">ЗАВЕДУЮЩАЯ</text>
  <text x="120" y="265" text-anchor="middle" font-family="Arial" font-size="9" fill="white">targetRole: manager</text>

  <!-- Arrow to Questions -->
  <path d="M190 170 L240 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M190 250 L240 220" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Questions Page -->
  <rect x="250" y="150" width="220" height="120" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
  <text x="360" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">
    Вопросы сдачи смены
  </text>
  <text x="265" y="198" font-family="Arial" font-size="10" fill="#333">Типы ответов (как в Shifts):</text>
  <text x="275" y="215" font-family="Arial" font-size="9" fill="#333">- Да/Нет | Текст | Число | Фото</text>
  <text x="265" y="235" font-family="Arial" font-size="10" fill="#333" font-weight="bold">+ targetRole:</text>
  <text x="275" y="252" font-family="Arial" font-size="9" fill="#333">"manager" или "employee"</text>

  <!-- Arrow to Report -->
  <path d="M470 210 L530 210" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Report Creation -->
  <rect x="540" y="150" width="180" height="120" rx="10" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
  <text x="630" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#E65100">
    Создание отчёта
  </text>
  <text x="555" y="198" font-family="Arial" font-size="10" fill="#333">ShiftHandoverReport:</text>
  <text x="565" y="215" font-family="Arial" font-size="9" fill="#333">- employeeName</text>
  <text x="565" y="230" font-family="Arial" font-size="9" fill="#333">- shopAddress</text>
  <text x="565" y="245" font-family="Arial" font-size="9" fill="#333">- answers[]</text>
  <text x="565" y="260" font-family="Arial" font-size="9" fill="#333">- status: pending</text>

  <!-- Arrow to Server -->
  <path d="M630 270 L630 310" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="650" y="295" font-family="Arial" font-size="9" fill="#333">POST</text>

  <!-- Server -->
  <rect x="490" y="320" width="280" height="80" rx="10" fill="url(#serverGrad)" filter="url(#shadow)"/>
  <text x="630" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">СЕРВЕР</text>
  <text x="630" y="370" text-anchor="middle" font-family="monospace" font-size="10" fill="white">POST /api/shift-handover-reports</text>
  <text x="630" y="390" text-anchor="middle" font-family="Arial" font-size="9" fill="white">shift_handover_reports.json</text>

  <!-- Admin Section -->
  <rect x="50" y="310" width="150" height="70" rx="10" fill="url(#adminGrad)" filter="url(#shadow)"/>
  <text x="125" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">АДМИН</text>
  <text x="125" y="358" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Отчеты</text>

  <!-- Arrow to Reports List -->
  <path d="M200 345 L250 345" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Reports List (4 tabs) -->
  <rect x="260" y="295" width="210" height="130" rx="10" fill="#FFEBEE" stroke="#E53935" stroke-width="2"/>
  <text x="365" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#C62828">
    Отчёты (Сдача Смены)
  </text>
  <text x="275" y="343" font-family="Arial" font-size="10" fill="#333" font-weight="bold">4 вкладки:</text>
  <text x="285" y="360" font-family="Arial" font-size="9" fill="#333">1. Ожидающие (pending)</text>
  <text x="285" y="375" font-family="Arial" font-size="9" fill="#333">2. Подтверждённые (confirmed)</text>
  <text x="285" y="390" font-family="Arial" font-size="9" fill="#333">3. Не проверенные (6+ часов)</text>
  <text x="285" y="405" font-family="Arial" font-size="9" fill="#333">4. Просроченные (expired)</text>

  <!-- Key Difference Box -->
  <rect x="50" y="430" width="820" height="120" rx="10" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="460" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">
    ОТЛИЧИЕ ОТ ПЕРЕСМЕНКИ (SHIFTS)
  </text>

  <rect x="70" y="470" width="380" height="65" rx="8" fill="#C8E6C9"/>
  <text x="260" y="492" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#1B5E20">targetRole - Кому адресован вопрос</text>
  <text x="85" y="515" font-family="Arial" font-size="10" fill="#333">"manager" - вопросы для заведующей магазина</text>
  <text x="85" y="530" font-family="Arial" font-size="10" fill="#333">"employee" - вопросы для обычного сотрудника</text>

  <rect x="470" y="470" width="380" height="65" rx="8" fill="#FFECB3"/>
  <text x="660" y="492" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#E65100">Когда заполняется</text>
  <text x="485" y="515" font-family="Arial" font-size="10" fill="#333">Shifts - при ПРИХОДЕ на смену (начало работы)</text>
  <text x="485" y="530" font-family="Arial" font-size="10" fill="#333">Shift Handover - при УХОДЕ со смены (конец работы)</text>

  <!-- ============ DESCRIPTION SECTION ============ -->
  <rect x="900" y="85" width="480" height="480" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="1140" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ОПИСАНИЕ СИСТЕМЫ
  </text>

  <!-- Files Section -->
  <rect x="920" y="125" width="440" height="130" rx="5" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="1140" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">ФАЙЛЫ FLUTTER</text>

  <text x="940" y="170" font-family="monospace" font-size="9" fill="#333">lib/features/shift_handover/pages/</text>
  <text x="955" y="185" font-family="monospace" font-size="9" fill="#1565C0">shift_handover_questions_page.dart</text>
  <text x="955" y="200" font-family="monospace" font-size="9" fill="#1565C0">shift_handover_reports_list_page.dart</text>
  <text x="955" y="215" font-family="monospace" font-size="9" fill="#1565C0">shift_handover_questions_management_page.dart</text>

  <text x="940" y="235" font-family="monospace" font-size="9" fill="#333">lib/features/shift_handover/services/</text>
  <text x="955" y="250" font-family="monospace" font-size="9" fill="#1565C0">shift_handover_question_service.dart</text>

  <!-- API Section -->
  <rect x="920" y="265" width="440" height="110" rx="5" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1140" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2E7D32">API ЭНДПОИНТЫ</text>

  <text x="940" y="310" font-family="monospace" font-size="10" fill="#333">GET  /api/shift-handover-questions</text>
  <text x="940" y="328" font-family="monospace" font-size="10" fill="#333">POST /api/shift-handover-questions</text>
  <text x="940" y="346" font-family="monospace" font-size="10" fill="#333">POST /api/shift-handover-reports</text>
  <text x="940" y="364" font-family="monospace" font-size="10" fill="#333">PUT  /api/shift-handover-reports/:id</text>

  <!-- Models Section -->
  <rect x="920" y="385" width="440" height="170" rx="5" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="1140" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7B1FA2">МОДЕЛИ ДАННЫХ</text>

  <text x="940" y="430" font-family="Arial" font-size="10" fill="#333" font-weight="bold">ShiftHandoverQuestion:</text>
  <text x="955" y="445" font-family="monospace" font-size="9" fill="#333">id, question, answerFormatB, answerFormatC</text>
  <text x="955" y="460" font-family="monospace" font-size="9" fill="#333">shops, referencePhotos</text>
  <text x="955" y="475" font-family="monospace" font-size="9" fill="#9C27B0" font-weight="bold">targetRole: "manager" | "employee"</text>

  <text x="940" y="498" font-family="Arial" font-size="10" fill="#333" font-weight="bold">ShiftHandoverReport:</text>
  <text x="955" y="513" font-family="monospace" font-size="9" fill="#333">id, employeeName, shopAddress, createdAt</text>
  <text x="955" y="528" font-family="monospace" font-size="9" fill="#333">answers[], status, confirmedAt, rating</text>
  <text x="955" y="543" font-family="monospace" font-size="9" fill="#333">confirmedByAdmin, expiredAt</text>

  <!-- ============ TARGET ROLE FLOW ============ -->
  <rect x="20" y="580" width="1360" height="150" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="700" y="605" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    ПОТОК ВОПРОСОВ ПО РОЛИ (targetRole)
  </text>

  <!-- Manager questions -->
  <rect x="40" y="625" width="640" height="90" rx="8" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="360" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#7B1FA2">targetRole = "manager" (Заведующая)</text>
  <text x="55" y="675" font-family="Arial" font-size="10" fill="#333">Примеры вопросов:</text>
  <text x="70" y="692" font-family="Arial" font-size="9" fill="#666">- Все ли сотрудники пришли вовремя?</text>
  <text x="70" y="707" font-family="Arial" font-size="9" fill="#666">- Выручка за смену (число)?</text>
  <text x="320" y="692" font-family="Arial" font-size="9" fill="#666">- Были ли проблемы с оборудованием?</text>
  <text x="320" y="707" font-family="Arial" font-size="9" fill="#666">- Фото кассы на конец смены</text>

  <!-- Employee questions -->
  <rect x="700" y="625" width="660" height="90" rx="8" fill="#E3F2FD" stroke="#2196F3"/>
  <text x="1030" y="650" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#1565C0">targetRole = "employee" (Сотрудник)</text>
  <text x="715" y="675" font-family="Arial" font-size="10" fill="#333">Примеры вопросов:</text>
  <text x="730" y="692" font-family="Arial" font-size="9" fill="#666">- Убрали ли вы рабочее место?</text>
  <text x="730" y="707" font-family="Arial" font-size="9" fill="#666">- Были ли жалобы от клиентов?</text>
  <text x="980" y="692" font-family="Arial" font-size="9" fill="#666">- Сделали ли инвентаризацию?</text>
  <text x="980" y="707" font-family="Arial" font-size="9" fill="#666">- Фото чистоты витрины</text>

  <!-- Storage Section -->
  <rect x="20" y="745" width="1360" height="80" rx="10" fill="#E0E0E0"/>
  <text x="700" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    ХРАНЕНИЕ ДАННЫХ
  </text>
  <text x="700" y="800" text-anchor="middle" font-family="monospace" font-size="11" fill="#333">
    Сервер: /data/shift_handover_questions.json | /data/shift_handover_reports.json | /uploads/shift_handover/
  </text>
  <text x="700" y="820" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">
    Локально: SharedPreferences (shift_handover_reports) - кэш отчётов
  </text>

  <!-- Important Notes -->
  <rect x="20" y="840" width="1360" height="100" rx="10" fill="#FFFDE7" stroke="#FBC02D" filter="url(#shadow)"/>
  <text x="700" y="865" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#F57F17">
    ВАЖНЫЕ ЗАМЕЧАНИЯ
  </text>
  <text x="40" y="890" font-family="Arial" font-size="11" fill="#333">
    1. targetRole позволяет задавать разные вопросы заведующей и обычным сотрудникам
  </text>
  <text x="40" y="910" font-family="Arial" font-size="11" fill="#333">
    2. Статусы отчётов (pending/confirmed/expired) и логика подтверждения идентичны системе Shifts
  </text>
  <text x="40" y="930" font-family="Arial" font-size="11" fill="#333">
    3. Время хранится в UTC на сервере, конвертируется в локальное при отображении
  </text>

  <!-- Version info -->
  <rect x="20" y="955" width="1360" height="50" rx="10" fill="#E0E0E0"/>
  <text x="700" y="985" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Arabica App v1.6.1 | Документация: Блок B - Система #6 | Создано: 2026-01-13
  </text>
</svg>
