<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1150">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="employeeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3"/>
      <stop offset="100%" style="stop-color:#1565C0"/>
    </linearGradient>
    <linearGradient id="adminGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F44336"/>
      <stop offset="100%" style="stop-color:#C62828"/>
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0"/>
      <stop offset="100%" style="stop-color:#6A1B9A"/>
    </linearGradient>
    <linearGradient id="grade1Grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F44336"/>
      <stop offset="100%" style="stop-color:#C62828"/>
    </linearGradient>
    <linearGradient id="grade2Grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800"/>
      <stop offset="100%" style="stop-color:#EF6C00"/>
    </linearGradient>
    <linearGradient id="grade3Grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#2E7D32"/>
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1150" fill="#f5f5f5"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#333">
    СИСТЕМА ПЕРЕСЧЁТА ТОВАРОВ (RECOUNT)
  </text>
  <text x="700" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">
    Arabica App - Блок B, Система #7 | Инвентаризация по баркодам
  </text>

  <!-- ============ VISUAL FLOW SECTION ============ -->
  <rect x="20" y="85" width="860" height="520" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="450" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ВИЗУАЛЬНАЯ СХЕМА
  </text>

  <!-- Employee Flow -->
  <rect x="50" y="130" width="150" height="70" rx="10" fill="url(#employeeGrad)" filter="url(#shadow)"/>
  <text x="125" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">СОТРУДНИК</text>
  <text x="125" y="178" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Пересчёт товаров</text>

  <!-- Arrow to Questions -->
  <path d="M200 165 L250 165" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Questions Selection -->
  <rect x="260" y="130" width="220" height="130" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
  <text x="370" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">
    Выбор товаров (30 шт)
  </text>
  <text x="275" y="178" font-family="Arial" font-size="10" fill="#333" font-weight="bold">Алгоритм распределения:</text>
  <text x="285" y="195" font-family="Arial" font-size="9" fill="#333">- 50% грейд 1 (очень важные)</text>
  <text x="285" y="210" font-family="Arial" font-size="9" fill="#333">- 30% грейд 2 (средние)</text>
  <text x="285" y="225" font-family="Arial" font-size="9" fill="#333">- 20% грейд 3 (не очень важные)</text>
  <text x="275" y="248" font-family="Arial" font-size="9" fill="#666">Перемешиваются случайно</text>

  <!-- Arrow to Answer -->
  <path d="M480 195 L540 195" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Answer Input -->
  <rect x="550" y="130" width="200" height="130" rx="10" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
  <text x="650" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#E65100">
    Ответ на товар
  </text>
  <text x="565" y="180" font-family="Arial" font-size="10" fill="#333" font-weight="bold">Варианты:</text>
  <text x="575" y="198" font-family="Arial" font-size="9" fill="#4CAF50">СХОДИТСЯ → ввод количества</text>
  <text x="575" y="216" font-family="Arial" font-size="9" fill="#E53935">НЕ СХОДИТСЯ →</text>
  <text x="585" y="232" font-family="Arial" font-size="8" fill="#333">- Остаток по программе</text>
  <text x="585" y="246" font-family="Arial" font-size="8" fill="#333">- Фактический остаток</text>
  <text x="585" y="260" font-family="Arial" font-size="8" fill="#333">- Фото (если грейд 1)</text>

  <!-- Arrow to Report -->
  <path d="M650 260 L650 300" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Report Creation -->
  <rect x="500" y="310" width="250" height="100" rx="10" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="625" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2E7D32">
    RecountReport
  </text>
  <text x="515" y="358" font-family="Arial" font-size="9" fill="#333">startedAt, completedAt, duration</text>
  <text x="515" y="373" font-family="Arial" font-size="9" fill="#333">answers[] - список ответов</text>
  <text x="515" y="388" font-family="Arial" font-size="9" fill="#333">status: "pending" | "rated" | "expired"</text>
  <text x="515" y="403" font-family="Arial" font-size="9" fill="#333">adminRating: 1-10 (после оценки)</text>

  <!-- Arrow to Server -->
  <path d="M625 410 L625 450" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="645" y="435" font-family="Arial" font-size="9" fill="#333">POST</text>

  <!-- Server -->
  <rect x="450" y="460" width="350" height="80" rx="10" fill="url(#serverGrad)" filter="url(#shadow)"/>
  <text x="625" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">СЕРВЕР</text>
  <text x="625" y="510" text-anchor="middle" font-family="monospace" font-size="10" fill="white">POST /api/recount-reports</text>
  <text x="625" y="530" text-anchor="middle" font-family="Arial" font-size="9" fill="white">/data/recount_reports.json | /uploads/recount/ (фото)</text>

  <!-- Admin Section -->
  <rect x="50" y="310" width="150" height="70" rx="10" fill="url(#adminGrad)" filter="url(#shadow)"/>
  <text x="125" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">АДМИН</text>
  <text x="125" y="358" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Отчеты</text>

  <!-- Arrow to Reports List -->
  <path d="M200 345 L250 345" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Reports List (4 tabs) -->
  <rect x="260" y="290" width="210" height="130" rx="10" fill="#FFEBEE" stroke="#E53935" stroke-width="2"/>
  <text x="365" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#C62828">
    Отчёты по пересчёту
  </text>
  <text x="275" y="340" font-family="Arial" font-size="10" fill="#333" font-weight="bold">4 вкладки:</text>
  <text x="285" y="357" font-family="Arial" font-size="9" fill="#333">1. Ожидающие (pending)</text>
  <text x="285" y="372" font-family="Arial" font-size="9" fill="#333">2. Оценённые (rated)</text>
  <text x="285" y="387" font-family="Arial" font-size="9" fill="#333">3. Не проверенные (6+ часов)</text>
  <text x="285" y="402" font-family="Arial" font-size="9" fill="#333">4. Просроченные (expired)</text>

  <!-- Management -->
  <rect x="50" y="430" width="380" height="110" rx="10" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="240" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#7B1FA2">
    Управление пересчётом (Админ)
  </text>
  <text x="65" y="480" font-family="Arial" font-size="10" fill="#333" font-weight="bold">Вкладки:</text>
  <text x="75" y="497" font-family="Arial" font-size="9" fill="#333">- Товары: добавление, удаление, баркоды</text>
  <text x="75" y="512" font-family="Arial" font-size="9" fill="#333">- Грейды: установка важности товаров (1-3)</text>
  <text x="75" y="527" font-family="Arial" font-size="9" fill="#333">- Баллы: настройка очков за пересчёт</text>

  <!-- ============ DESCRIPTION SECTION ============ -->
  <rect x="900" y="85" width="480" height="520" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="1140" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ОПИСАНИЕ СИСТЕМЫ
  </text>

  <!-- Files Section -->
  <rect x="920" y="125" width="440" height="140" rx="5" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="1140" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">ФАЙЛЫ FLUTTER</text>

  <text x="940" y="170" font-family="monospace" font-size="9" fill="#333">lib/features/recount/pages/</text>
  <text x="955" y="185" font-family="monospace" font-size="9" fill="#1565C0">recount_questions_page.dart</text>
  <text x="1220" y="185" font-family="Arial" font-size="8" fill="#666">← UI пересчёта</text>
  <text x="955" y="200" font-family="monospace" font-size="9" fill="#1565C0">recount_reports_list_page.dart</text>
  <text x="1220" y="200" font-family="Arial" font-size="8" fill="#666">← 4 вкладки</text>
  <text x="955" y="215" font-family="monospace" font-size="9" fill="#1565C0">recount_management_tabs_page.dart</text>
  <text x="1240" y="215" font-family="Arial" font-size="8" fill="#666">← Управление</text>

  <text x="940" y="235" font-family="monospace" font-size="9" fill="#333">lib/features/recount/services/</text>
  <text x="955" y="250" font-family="monospace" font-size="9" fill="#1565C0">recount_question_service.dart</text>
  <text x="955" y="265" font-family="monospace" font-size="9" fill="#1565C0">recount_service.dart</text>

  <!-- API Section -->
  <rect x="920" y="275" width="440" height="115" rx="5" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1140" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2E7D32">API ЭНДПОИНТЫ</text>

  <text x="940" y="318" font-family="monospace" font-size="10" fill="#333">GET  /api/recount-questions</text>
  <text x="1200" y="318" font-family="Arial" font-size="9" fill="#666">Список товаров</text>
  <text x="940" y="336" font-family="monospace" font-size="10" fill="#333">POST /api/recount-questions</text>
  <text x="1200" y="336" font-family="Arial" font-size="9" fill="#666">Добавить товар</text>
  <text x="940" y="354" font-family="monospace" font-size="10" fill="#333">POST /api/recount-reports</text>
  <text x="1200" y="354" font-family="Arial" font-size="9" fill="#666">Сохранить отчёт</text>
  <text x="940" y="372" font-family="monospace" font-size="10" fill="#333">PUT  /api/recount-reports/:id</text>
  <text x="1200" y="372" font-family="Arial" font-size="9" fill="#666">Оценить</text>

  <!-- Models Section -->
  <rect x="920" y="400" width="440" height="195" rx="5" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="1140" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7B1FA2">МОДЕЛИ ДАННЫХ</text>

  <text x="940" y="445" font-family="Arial" font-size="10" fill="#333" font-weight="bold">RecountQuestion (товар):</text>
  <text x="955" y="460" font-family="monospace" font-size="9" fill="#333">id, barcode, productGroup, productName</text>
  <text x="955" y="475" font-family="monospace" font-size="9" fill="#9C27B0" font-weight="bold">grade: 1 | 2 | 3 (важность)</text>

  <text x="940" y="498" font-family="Arial" font-size="10" fill="#333" font-weight="bold">RecountAnswer:</text>
  <text x="955" y="513" font-family="monospace" font-size="9" fill="#333">question, grade, answer ("сходится"/"не сходится")</text>
  <text x="955" y="528" font-family="monospace" font-size="9" fill="#333">quantity | programBalance, actualBalance, difference</text>
  <text x="955" y="543" font-family="monospace" font-size="9" fill="#333">photoPath, photoUrl, photoRequired</text>

  <text x="940" y="566" font-family="Arial" font-size="10" fill="#333" font-weight="bold">RecountReport:</text>
  <text x="955" y="581" font-family="monospace" font-size="9" fill="#333">id, employeeName, shopAddress, startedAt, completedAt</text>
  <text x="955" y="596" font-family="monospace" font-size="9" fill="#333">duration, answers[], adminRating, status</text>

  <!-- ============ GRADE SYSTEM ============ -->
  <rect x="20" y="620" width="1360" height="180" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="700" y="645" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    СИСТЕМА ГРЕЙДОВ (ВАЖНОСТЬ ТОВАРОВ)
  </text>

  <!-- Grade 1 -->
  <rect x="40" y="665" width="400" height="120" rx="8" fill="#FFEBEE" stroke="#E53935"/>
  <text x="240" y="690" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#C62828">ГРЕЙД 1 - Очень важные (50%)</text>
  <text x="55" y="715" font-family="Arial" font-size="10" fill="#333">Дорогие/ходовые товары, требуют повышенного контроля</text>
  <text x="55" y="735" font-family="Arial" font-size="10" fill="#333" font-weight="bold">При "не сходится":</text>
  <text x="65" y="752" font-family="Arial" font-size="9" fill="#333">- Обязательное фото витрины/полки</text>
  <text x="65" y="767" font-family="Arial" font-size="9" fill="#333">- Максимальный штраф за расхождение</text>
  <text x="65" y="782" font-family="Arial" font-size="9" fill="#333">- Приоритетная проверка админом</text>

  <!-- Grade 2 -->
  <rect x="460" y="665" width="400" height="120" rx="8" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="660" y="690" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#E65100">ГРЕЙД 2 - Средней важности (30%)</text>
  <text x="475" y="715" font-family="Arial" font-size="10" fill="#333">Товары среднего ценового сегмента</text>
  <text x="475" y="735" font-family="Arial" font-size="10" fill="#333" font-weight="bold">При "не сходится":</text>
  <text x="485" y="752" font-family="Arial" font-size="9" fill="#333">- Фото опционально</text>
  <text x="485" y="767" font-family="Arial" font-size="9" fill="#333">- Средний штраф за расхождение</text>
  <text x="485" y="782" font-family="Arial" font-size="9" fill="#333">- Стандартная проверка</text>

  <!-- Grade 3 -->
  <rect x="880" y="665" width="480" height="120" rx="8" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1120" y="690" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#2E7D32">ГРЕЙД 3 - Не очень важные (20%)</text>
  <text x="895" y="715" font-family="Arial" font-size="10" fill="#333">Недорогие товары, расходники</text>
  <text x="895" y="735" font-family="Arial" font-size="10" fill="#333" font-weight="bold">При "не сходится":</text>
  <text x="905" y="752" font-family="Arial" font-size="9" fill="#333">- Фото не требуется</text>
  <text x="905" y="767" font-family="Arial" font-size="9" fill="#333">- Минимальный штраф за расхождение</text>
  <text x="905" y="782" font-family="Arial" font-size="9" fill="#333">- Проверка по остаточному принципу</text>

  <!-- Storage Section -->
  <rect x="20" y="815" width="1360" height="80" rx="10" fill="#E0E0E0"/>
  <text x="700" y="845" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    ХРАНЕНИЕ ДАННЫХ
  </text>
  <text x="700" y="870" text-anchor="middle" font-family="monospace" font-size="11" fill="#333">
    Сервер: /data/recount_questions.json | /data/recount_reports.json | /uploads/recount/
  </text>
  <text x="700" y="890" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">
    Товары содержат: barcode, productGroup, productName, grade | Отчёты хранят время начала/конца + все ответы
  </text>

  <!-- Important Notes -->
  <rect x="20" y="910" width="1360" height="100" rx="10" fill="#FFFDE7" stroke="#FBC02D" filter="url(#shadow)"/>
  <text x="700" y="935" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#F57F17">
    ВАЖНЫЕ ЗАМЕЧАНИЯ
  </text>
  <text x="40" y="960" font-family="Arial" font-size="11" fill="#333">
    1. При каждом пересчёте выбираются 30 случайных товаров по алгоритму грейдов (50%/30%/20%)
  </text>
  <text x="40" y="980" font-family="Arial" font-size="11" fill="#333">
    2. Фиксируется время начала и окончания пересчёта (duration) - влияет на баллы эффективности
  </text>
  <text x="40" y="1000" font-family="Arial" font-size="11" fill="#333">
    3. Для товаров грейда 1 при расхождении обязательно фото - без него отчёт не отправится
  </text>

  <!-- Version info -->
  <rect x="20" y="1020" width="1360" height="50" rx="10" fill="#E0E0E0"/>
  <text x="700" y="1050" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Arabica App v1.6.1 | Документация: Блок B - Система #7 | Создано: 2026-01-13
  </text>
</svg>
