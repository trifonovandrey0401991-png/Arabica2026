<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1150">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="employeeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3"/>
      <stop offset="100%" style="stop-color:#1565C0"/>
    </linearGradient>
    <linearGradient id="adminGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F44336"/>
      <stop offset="100%" style="stop-color:#C62828"/>
    </linearGradient>
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0"/>
      <stop offset="100%" style="stop-color:#6A1B9A"/>
    </linearGradient>
    <linearGradient id="pendingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800"/>
      <stop offset="100%" style="stop-color:#EF6C00"/>
    </linearGradient>
    <linearGradient id="confirmedGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#2E7D32"/>
    </linearGradient>
    <linearGradient id="expiredGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9E9E9E"/>
      <stop offset="100%" style="stop-color:#616161"/>
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="1150" fill="#f5f5f5"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#333">
    СИСТЕМА ПЕРЕСМЕНКИ (SHIFTS)
  </text>
  <text x="700" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666">
    Arabica App - Блок B, Система #5 | Вопросы при приходе на смену
  </text>

  <!-- ============ VISUAL FLOW SECTION ============ -->
  <rect x="20" y="85" width="860" height="520" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="450" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ВИЗУАЛЬНАЯ СХЕМА
  </text>

  <!-- Employee Flow -->
  <rect x="50" y="130" width="150" height="70" rx="10" fill="url(#employeeGrad)" filter="url(#shadow)"/>
  <text x="125" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">СОТРУДНИК</text>
  <text x="125" y="178" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Панель работника</text>

  <!-- Arrow to Questions -->
  <path d="M200 165 L250 165" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Questions Page -->
  <rect x="260" y="130" width="200" height="120" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2"/>
  <text x="360" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0">
    Вопросы пересменки
  </text>
  <text x="275" y="178" font-family="Arial" font-size="10" fill="#333">Типы ответов:</text>
  <text x="285" y="195" font-family="Arial" font-size="9" fill="#333">- Да/Нет</text>
  <text x="285" y="210" font-family="Arial" font-size="9" fill="#333">- Текст</text>
  <text x="285" y="225" font-family="Arial" font-size="9" fill="#333">- Число</text>
  <text x="285" y="240" font-family="Arial" font-size="9" fill="#333">- Фото (с эталоном)</text>

  <!-- Arrow to Report -->
  <path d="M460 185 L520 185" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Report Creation -->
  <rect x="530" y="130" width="180" height="120" rx="10" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
  <text x="620" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#E65100">
    Создание отчёта
  </text>
  <text x="545" y="178" font-family="Arial" font-size="10" fill="#333">ShiftReport содержит:</text>
  <text x="555" y="195" font-family="Arial" font-size="9" fill="#333">- employeeName</text>
  <text x="555" y="210" font-family="Arial" font-size="9" fill="#333">- shopAddress</text>
  <text x="555" y="225" font-family="Arial" font-size="9" fill="#333">- answers[]</text>
  <text x="555" y="240" font-family="Arial" font-size="9" fill="#333">- status: pending</text>

  <!-- Arrow to Server -->
  <path d="M620 250 L620 290" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="640" y="275" font-family="Arial" font-size="9" fill="#333">POST</text>

  <!-- Server -->
  <rect x="480" y="300" width="280" height="80" rx="10" fill="url(#serverGrad)" filter="url(#shadow)"/>
  <text x="620" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white">СЕРВЕР</text>
  <text x="620" y="350" text-anchor="middle" font-family="monospace" font-size="10" fill="white">POST /api/shift-reports</text>
  <text x="620" y="370" text-anchor="middle" font-family="Arial" font-size="9" fill="white">Сохраняет в shift_reports.json</text>

  <!-- Admin Section -->
  <rect x="50" y="280" width="150" height="70" rx="10" fill="url(#adminGrad)" filter="url(#shadow)"/>
  <text x="125" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">АДМИН</text>
  <text x="125" y="328" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Отчеты</text>

  <!-- Arrow to Reports List -->
  <path d="M200 315 L250 315" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Reports List (4 tabs) -->
  <rect x="260" y="270" width="200" height="130" rx="10" fill="#FFEBEE" stroke="#E53935" stroke-width="2"/>
  <text x="360" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#C62828">
    Отчёты по пересменкам
  </text>
  <text x="275" y="318" font-family="Arial" font-size="10" fill="#333" font-weight="bold">4 вкладки:</text>
  <text x="285" y="335" font-family="Arial" font-size="9" fill="#333">1. Ожидающие (pending)</text>
  <text x="285" y="350" font-family="Arial" font-size="9" fill="#333">2. Подтверждённые (confirmed)</text>
  <text x="285" y="365" font-family="Arial" font-size="9" fill="#333">3. Не проверенные (6+ часов)</text>
  <text x="285" y="380" font-family="Arial" font-size="9" fill="#333">4. Просроченные (expired)</text>

  <!-- Status Blocks -->
  <text x="450" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    СТАТУСЫ ОТЧЁТА
  </text>

  <!-- Pending -->
  <rect x="50" y="450" width="180" height="70" rx="8" fill="url(#pendingGrad)" filter="url(#shadow)"/>
  <text x="140" y="480" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">ОЖИДАЕТ</text>
  <text x="140" y="498" text-anchor="middle" font-family="Arial" font-size="10" fill="white">status: pending</text>
  <text x="140" y="513" text-anchor="middle" font-family="Arial" font-size="9" fill="white">confirmedAt: null</text>

  <!-- Arrow -->
  <path d="M230 485 L280 485" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Confirmed -->
  <rect x="290" y="450" width="180" height="70" rx="8" fill="url(#confirmedGrad)" filter="url(#shadow)"/>
  <text x="380" y="480" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">ПОДТВЕРЖДЁН</text>
  <text x="380" y="498" text-anchor="middle" font-family="Arial" font-size="10" fill="white">status: confirmed</text>
  <text x="380" y="513" text-anchor="middle" font-family="Arial" font-size="9" fill="white">rating: 1-10</text>

  <!-- Not Verified (6+ hours) -->
  <rect x="530" y="450" width="180" height="70" rx="8" fill="#FFCDD2" stroke="#E53935"/>
  <text x="620" y="480" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#C62828">НЕ ПРОВЕРЕН</text>
  <text x="620" y="498" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">6+ часов без проверки</text>
  <text x="620" y="513" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">verificationStatus</text>

  <!-- Expired -->
  <rect x="770" y="450" width="180" height="70" rx="8" fill="url(#expiredGrad)" filter="url(#shadow)"/>
  <text x="860" y="480" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">ПРОСРОЧЕН</text>
  <text x="860" y="498" text-anchor="middle" font-family="Arial" font-size="10" fill="white">status: expired</text>
  <text x="860" y="513" text-anchor="middle" font-family="Arial" font-size="9" fill="white">24+ часов</text>

  <!-- Efficiency impact -->
  <rect x="50" y="540" width="820" height="50" rx="8" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="460" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2E7D32">
    Баллы эффективности: + за подтверждённый отчёт (rating) | - штраф за просроченный (настраивается админом)
  </text>

  <!-- ============ DESCRIPTION SECTION ============ -->
  <rect x="900" y="85" width="480" height="520" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="1140" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    ОПИСАНИЕ СИСТЕМЫ
  </text>

  <!-- Files Section -->
  <rect x="920" y="125" width="440" height="140" rx="5" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="1140" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#E65100">ФАЙЛЫ FLUTTER</text>

  <text x="940" y="170" font-family="monospace" font-size="9" fill="#333">lib/features/shifts/pages/</text>
  <text x="955" y="185" font-family="monospace" font-size="9" fill="#1565C0">shift_questions_page.dart</text>
  <text x="1200" y="185" font-family="Arial" font-size="8" fill="#666">← UI вопросов</text>
  <text x="955" y="200" font-family="monospace" font-size="9" fill="#1565C0">shift_reports_list_page.dart</text>
  <text x="1200" y="200" font-family="Arial" font-size="8" fill="#666">← 4 вкладки</text>
  <text x="955" y="215" font-family="monospace" font-size="9" fill="#1565C0">shift_questions_management_page.dart</text>
  <text x="1260" y="215" font-family="Arial" font-size="8" fill="#666">← Управление</text>

  <text x="940" y="235" font-family="monospace" font-size="9" fill="#333">lib/features/shifts/services/</text>
  <text x="955" y="250" font-family="monospace" font-size="9" fill="#1565C0">shift_question_service.dart</text>
  <text x="1200" y="250" font-family="Arial" font-size="8" fill="#666">← Вопросы API</text>
  <text x="955" y="265" font-family="monospace" font-size="9" fill="#1565C0">shift_report_service.dart</text>
  <text x="1200" y="265" font-family="Arial" font-size="8" fill="#666">← Отчёты API</text>

  <!-- API Section -->
  <rect x="920" y="275" width="440" height="130" rx="5" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="1140" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2E7D32">API ЭНДПОИНТЫ</text>

  <text x="940" y="318" font-family="monospace" font-size="10" fill="#333">GET    /api/shift-questions</text>
  <text x="1200" y="318" font-family="Arial" font-size="9" fill="#666">Список вопросов</text>
  <text x="940" y="336" font-family="monospace" font-size="10" fill="#333">POST   /api/shift-questions</text>
  <text x="1200" y="336" font-family="Arial" font-size="9" fill="#666">Создать вопрос</text>
  <text x="940" y="354" font-family="monospace" font-size="10" fill="#333">POST   /api/shift-reports</text>
  <text x="1200" y="354" font-family="Arial" font-size="9" fill="#666">Сохранить отчёт</text>
  <text x="940" y="372" font-family="monospace" font-size="10" fill="#333">GET    /api/shift-reports</text>
  <text x="1200" y="372" font-family="Arial" font-size="9" fill="#666">Список отчётов</text>
  <text x="940" y="390" font-family="monospace" font-size="10" fill="#333">PUT    /api/shift-reports/:id</text>
  <text x="1200" y="390" font-family="Arial" font-size="9" fill="#666">Подтвердить</text>

  <!-- Models Section -->
  <rect x="920" y="415" width="440" height="180" rx="5" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="1140" y="435" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7B1FA2">МОДЕЛИ ДАННЫХ</text>

  <text x="940" y="458" font-family="Arial" font-size="10" fill="#333" font-weight="bold">ShiftQuestion:</text>
  <text x="955" y="473" font-family="monospace" font-size="9" fill="#333">id, question, answerFormatB, answerFormatC</text>
  <text x="955" y="488" font-family="monospace" font-size="9" fill="#333">shops: List?, referencePhotos: Map?</text>

  <text x="940" y="510" font-family="Arial" font-size="10" fill="#333" font-weight="bold">ShiftReport:</text>
  <text x="955" y="525" font-family="monospace" font-size="9" fill="#333">id, employeeName, shopAddress, createdAt</text>
  <text x="955" y="540" font-family="monospace" font-size="9" fill="#333">answers: List&lt;ShiftAnswer&gt;, status</text>
  <text x="955" y="555" font-family="monospace" font-size="9" fill="#333">confirmedAt, rating, confirmedByAdmin</text>

  <text x="940" y="577" font-family="Arial" font-size="10" fill="#333" font-weight="bold">ShiftAnswer:</text>
  <text x="955" y="592" font-family="monospace" font-size="9" fill="#333">question, textAnswer, numberAnswer, photoPath</text>

  <!-- ============ ANSWER TYPES ============ -->
  <rect x="20" y="620" width="1360" height="180" rx="10" fill="white" stroke="#ddd" filter="url(#shadow)"/>
  <text x="700" y="645" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    ТИПЫ ОТВЕТОВ (определяются answerFormatB и answerFormatC)
  </text>

  <!-- Yes/No -->
  <rect x="40" y="665" width="300" height="120" rx="8" fill="#E3F2FD" stroke="#2196F3"/>
  <text x="190" y="690" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#1565C0">ДА / НЕТ</text>
  <text x="55" y="715" font-family="Arial" font-size="10" fill="#333">Условие: answerFormatB = null AND</text>
  <text x="55" y="730" font-family="Arial" font-size="10" fill="#333">         answerFormatC = null</text>
  <text x="55" y="755" font-family="Arial" font-size="10" fill="#666">UI: Два переключателя Да/Нет</text>
  <text x="55" y="775" font-family="Arial" font-size="10" fill="#666">Ответ: textAnswer = "Да" или "Нет"</text>

  <!-- Text -->
  <rect x="360" y="665" width="300" height="120" rx="8" fill="#FFF3E0" stroke="#FF9800"/>
  <text x="510" y="690" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#E65100">ТЕКСТ</text>
  <text x="375" y="715" font-family="Arial" font-size="10" fill="#333">Условие: НЕ число, НЕ фото, НЕ да/нет</text>
  <text x="375" y="735" font-family="Arial" font-size="10" fill="#333">(по умолчанию)</text>
  <text x="375" y="755" font-family="Arial" font-size="10" fill="#666">UI: TextField</text>
  <text x="375" y="775" font-family="Arial" font-size="10" fill="#666">Ответ: textAnswer = строка</text>

  <!-- Number -->
  <rect x="680" y="665" width="300" height="120" rx="8" fill="#E8F5E9" stroke="#4CAF50"/>
  <text x="830" y="690" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#2E7D32">ЧИСЛО</text>
  <text x="695" y="715" font-family="Arial" font-size="10" fill="#333">Условие: answerFormatC = "число"</text>
  <text x="695" y="735" font-family="Arial" font-size="10" fill="#333">         или "number"</text>
  <text x="695" y="755" font-family="Arial" font-size="10" fill="#666">UI: TextField с numeric keyboard</text>
  <text x="695" y="775" font-family="Arial" font-size="10" fill="#666">Ответ: numberAnswer = double</text>

  <!-- Photo -->
  <rect x="1000" y="665" width="360" height="120" rx="8" fill="#F3E5F5" stroke="#9C27B0"/>
  <text x="1180" y="690" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#7B1FA2">ФОТО (с эталоном)</text>
  <text x="1015" y="715" font-family="Arial" font-size="10" fill="#333">Условие: answerFormatB = "free" или "photo"</text>
  <text x="1015" y="735" font-family="Arial" font-size="10" fill="#333">referencePhotos[shopAddress] = URL эталона</text>
  <text x="1015" y="755" font-family="Arial" font-size="10" fill="#666">UI: Показ эталона + кнопка камеры</text>
  <text x="1015" y="775" font-family="Arial" font-size="10" fill="#666">Ответ: photoPath = путь к фото</text>

  <!-- Storage Section -->
  <rect x="20" y="815" width="1360" height="80" rx="10" fill="#E0E0E0"/>
  <text x="700" y="845" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">
    ХРАНЕНИЕ ДАННЫХ
  </text>
  <text x="700" y="870" text-anchor="middle" font-family="monospace" font-size="11" fill="#333">
    Сервер: /data/shift_questions.json | /data/shift_reports.json | /uploads/shifts/ (фото)
  </text>
  <text x="700" y="890" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">
    Локально: SharedPreferences (shift_reports) - кэш отчётов, автоочистка через 7 дней
  </text>

  <!-- Important Notes -->
  <rect x="20" y="910" width="1360" height="100" rx="10" fill="#FFFDE7" stroke="#FBC02D" filter="url(#shadow)"/>
  <text x="700" y="935" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#F57F17">
    ВАЖНЫЕ ЗАМЕЧАНИЯ
  </text>
  <text x="40" y="960" font-family="Arial" font-size="11" fill="#333">
    1. Вопросы можно привязать к конкретным магазинам (shops: [адреса]) или ко всем (shops: null)
  </text>
  <text x="40" y="980" font-family="Arial" font-size="11" fill="#333">
    2. Эталонные фото загружаются для каждого магазина отдельно (referencePhotos: {адрес: URL})
  </text>
  <text x="40" y="1000" font-family="Arial" font-size="11" fill="#333">
    3. Отчёт просрочен если не подтверждён админом в течение 24 часов (статус меняется на сервере)
  </text>

  <!-- Version info -->
  <rect x="20" y="1020" width="1360" height="50" rx="10" fill="#E0E0E0"/>
  <text x="700" y="1050" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#666">
    Arabica App v1.6.1 | Документация: Блок B - Система #5 | Создано: 2026-01-13
  </text>
</svg>
