# План оптимизации приложения

## Этап 1: Критические оптимизации (быстрый эффект)

### 1.1 Замена print() на условное логирование
**Файлы для изменения:**
- `lib/main.dart`
- `lib/loyalty_service.dart`
- `lib/firebase_service.dart`
- `lib/firebase_wrapper.dart`
- Все остальные файлы с print()

**Действия:**
1. Создать `lib/utils/logger.dart` (уже создан)
2. Заменить все `print()` на `Logger.debug()` / `Logger.error()`
3. Использовать `Logger.error()` только для критичных ошибок

**Ожидаемый эффект:** Улучшение производительности на 15-20%

### 1.2 Убрать задержку при запуске
**Файл:** `lib/main.dart:31`
**Действие:** Убрать `Future.delayed(Duration(milliseconds: 3000))`
**Альтернатива:** Использовать проверку готовности Firebase вместо задержки

**Ожидаемый эффект:** Запуск приложения быстрее на 3 секунды

### 1.3 Оптимизировать синхронизацию при запуске
**Файл:** `lib/main.dart:61`
**Действие:** 
- Выполнять синхронизацию в фоне (не блокировать запуск)
- Добавить проверку: синхронизировать только если прошло > 1 часа

**Ожидаемый эффект:** Запуск приложения быстрее на 1-2 секунды

## Этап 2: Оптимизация Firebase инициализации

### 2.1 Убрать задержки в Firebase
**Файлы:**
- `lib/firebase_service.dart` - убрать 7 задержек
- `lib/firebase_wrapper.dart` - убрать 4 задержки

**Действие:** Заменить задержки на проверку готовности

**Ожидаемый эффект:** Инициализация быстрее на 5-7 секунд

## Этап 3: Кэширование данных

### 3.1 Кэширование списка магазинов
**Файл:** `lib/shop_model.dart`
**Действие:** Использовать `CacheManager.getOrFetch()` для `loadShopsFromGoogleSheets()`

**Ожидаемый эффект:** Уменьшение запросов к API на 80-90%

### 3.2 Кэширование настроек магазинов
**Файл:** `lib/rko_service.dart`
**Действие:** Кэшировать результаты `getShopSettings()`

**Ожидаемый эффект:** Уменьшение запросов к API на 70-80%

## Этап 4: Оптимизация запросов

### 4.1 Уменьшить таймауты
**Файлы:** Все сервисы с `.timeout(Duration(seconds: 30))`
**Действие:** Уменьшить до 10-15 секунд

### 4.2 Оптимизировать логирование в Node.js
**Файл:** `loyalty-proxy/index.js`
**Действие:** 
- Убрать избыточные console.log
- Оставить только ошибки в production

## Этап 5: Параллельная обработка

### 5.1 Параллельная синхронизация отчетов
**Файл:** `lib/shift_sync_service.dart`
**Действие:** Обрабатывать отчеты параллельно (batch по 3-5)

## Порядок выполнения

1. **Сначала:** Этап 1 (критические оптимизации) - быстрый эффект
2. **Затем:** Этап 2 (Firebase) - улучшение запуска
3. **Потом:** Этап 3 (кэширование) - уменьшение нагрузки
4. **В конце:** Этапы 4-5 (финальные оптимизации)

## Важно!

⚠️ **НЕ ТРОГАТЬ РАБОТАЮЩИЙ ФУНКЦИОНАЛ!**
- Все изменения должны быть протестированы
- Сохранять обратную совместимость
- Делать изменения постепенно, проверяя каждый этап







